#undef SQLCA
#define SQLCA_NONE
#include<sqlca.h>

#include "tuxfw.h"
#include "LinhaTelefonicapcPORT.h"

EXEC SQL BEGIN DECLARE SECTION;
#include "PPGlobalPORT.h"
EXEC SQL END DECLARE SECTION;

/****************************************************************************************/
void CLinhaTelefonicapc::proCInsereLinhaTelefonica(TLinhaTelefonica *ptLinhaTelefonica)
{
    ULOG_START("CLinhaTelefonicapc::proCInsereLinhaTelefonica");

    EXEC SQL BEGIN DECLARE SECTION;
        VARCHAR oszIdLinhaTelefonica[LEN_IDLINHATELEFONICA];

        VARCHAR oszIdSistemaOrigem[LEN_IDSISTEMAORIGEM];
        VARCHAR oszIdLinhasistemaOrigem[LEN_IDLINHASISTEMAORIGEM];
        VARCHAR oszIdTipoLinha[LEN_IDTIPOLINHA];
        VARCHAR oszInDivulgacaoNrLinha[LEN_INDIVULGACAONRLINHA];
        VARCHAR oszCdChurnProbabilidade[LEN_CDCHURNPROBABILIDADE];
        VARCHAR oszVlrChurnProbabilidade[LEN_VLRCHURNPROBABILIDADE];
        VARCHAR oszIdLinhaBase[LEN_IDLINHABASE];
        VARCHAR oszIdUsuarioAlteracao[LEN_IDUSUARIOALTERACAO];
        VARCHAR oszInUsuarioInformado[LEN_INUSUARIOINFORMADO];
    EXEC SQL END DECLARE SECTION;

    struct sqlca sqlca;

    STRCPY_TO_ORA(oszIdSistemaOrigem, ptLinhaTelefonica->szIdSistemaOrigem);
    STRCPY_TO_ORA(oszIdLinhasistemaOrigem, ptLinhaTelefonica->szIdLinhasistemaOrigem);
    STRCPY_TO_ORA(oszIdTipoLinha, ptLinhaTelefonica->szIdTipoLinha);
    STRCPY_TO_ORA(oszInDivulgacaoNrLinha, ptLinhaTelefonica->szInDivulgacaoNrLinha);
    STRCPY_TO_ORA(oszCdChurnProbabilidade, ptLinhaTelefonica->szCdChurnProbabilidade);
    STRCPY_TO_ORA(oszVlrChurnProbabilidade, ptLinhaTelefonica->szVlrChurnProbabilidade);
    STRCPY_TO_ORA(oszIdLinhaBase, ptLinhaTelefonica->szIdLinhaBase);
    STRCPY_TO_ORA(oszIdUsuarioAlteracao, ptLinhaTelefonica->szIdUsuarioAlteracao);
    STRCPY_TO_ORA(oszInUsuarioInformado, ptLinhaTelefonica->szInUsuarioInformado);

    EXEC SQL WHENEVER SQLERROR goto erro;

    EXEC SQL SELECT linha.linhatelefonicasq.nextval INTO :oszIdLinhaTelefonica FROM DUAL;

    STRCPY_FROM_ORA(ptLinhaTelefonica->szIdLinhaTelefonica, oszIdLinhaTelefonica);

    EXEC SQL INSERT INTO customer.linhatelefonica
                        (   
                        idlinhatelefonica,
                        idsistemaorigem,
                        idlinhasistemaorigem,
                        idtipolinha,
                        indivulgacaonrlinha,
                        dthabilitacao,
                        cdchurnprobabilidade,
                        vlrchurnprobabilidade,
                        idlinhabase,
                        idusuarioalteracao,
                        inusuarioinformado,
                        dtultimaalteracao
                        )
                VALUES
                        (
                         :oszIdLinhaTelefonica,
                         :oszIdSistemaOrigem,
                         :oszIdLinhasistemaOrigem,
                         :oszIdTipoLinha,
                         :oszInDivulgacaoNrLinha,
                         SYSDATE,
                         :oszCdChurnProbabilidade,
                         :oszVlrChurnProbabilidade,
                         :oszIdLinhaBase,
                         :oszIdUsuarioAlteracao,
                         :oszInUsuarioInformado,
                         SYSDATE
                        );


    ULOGI("Finalizando proCInsereLinhaTelefonica <OK>");
    ULOG_END("CLinhaTelefonicapc::proCInsereLinhaTelefonica");
    return;

    erro:
        ULOGE("Finalizando proCInsereLinhaTelefonica <ERROR>");
        throw new TuxBasicOraException(sqlca.sqlcode, sqlca.sqlerrm.sqlerrmc, sqlca.sqlerrm.sqlerrml);
}
