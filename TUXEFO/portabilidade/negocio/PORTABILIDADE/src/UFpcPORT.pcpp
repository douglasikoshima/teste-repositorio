#undef SQLCA
#define SQLCA_NONE
#include<sqlca.h>

#include "tuxfw.h"
#include "UFpcPORT.h"

EXEC SQL BEGIN DECLARE SECTION;
#include "PPGlobalPORT.h"
EXEC SQL END DECLARE SECTION;

/****************************************************************************************/
bool CUFpc::proCBuscaUF(TUF *ptUF)
{
    ULOG_START("CUFpc::proCBuscaUF");

    EXEC SQL BEGIN DECLARE SECTION;
        VARCHAR oszIdUF[LEN_IDUF];
        VARCHAR oszSgUF[LEN_SGUF];
        VARCHAR oszNmUF[LEN_NMUF];

        short iIdUF = 0;
        short iSgUF = 0;
        short iNmUF = 0;
    EXEC SQL END DECLARE SECTION;

    struct sqlca sqlca;

    STRCPY_TO_ORA(oszSgUF, ptUF->szSgUF);

    EXEC SQL WHENEVER SQLERROR goto erro;
    EXEC SQL WHENEVER NOT FOUND goto naoexiste;

    EXEC SQL SELECT iduf
                  , sguf
                  , nmuf
               INTO :oszIdUF:iIdUF
                  , :oszSgUF:iSgUF
                  , :oszNmUF:iNmUF
               FROM apoio.uf
              WHERE sguf = :oszSgUF;


    if(iIdUF != -1) {
        STRCPY_FROM_ORA(ptUF->szIdUF, oszIdUF);
    }
    if(iSgUF != -1) {
        STRCPY_FROM_ORA(ptUF->szSgUF, oszSgUF);
    }
    if(iNmUF != -1) {
        STRCPY_FROM_ORA(ptUF->szNmUF, oszNmUF);
    }


    ULOGI("Finalizando proCBuscaUF <FOUND>");
    ULOG_END("CUFpc::proCBuscaUF");
    return true;

    naoexiste:
        ULOGI("Finalizando proCBuscaUF <NOT FOUND>");
        return false;

    erro:
        ULOGE("Finalizando proCBuscaUF <ERROR>");
        throw new TuxBasicOraException(sqlca.sqlcode, sqlca.sqlerrm.sqlerrmc, sqlca.sqlerrm.sqlerrml);
}

/****************************************************************************************/
bool CUFpc::proCBuscaIdUF(TUF *ptUF)
{
    ULOG_START("CUFpc::proCBuscaUF");

    EXEC SQL BEGIN DECLARE SECTION;
        VARCHAR oszIdUf[LEN_IDUF];
        VARCHAR oszSgUf[LEN_SGUF];
        VARCHAR oszNmUf[LEN_NMUF];

        short iSgUf = 0;
        short iNmUf = 0;
    EXEC SQL END DECLARE SECTION;

    struct sqlca sqlca;

    STRCPY_TO_ORA(oszIdUf, ptUF->szIdUF);

    EXEC SQL WHENEVER SQLERROR goto erro;
    EXEC SQL WHENEVER NOT FOUND goto naoexiste;

    EXEC SQL SELECT sguf
                  , nmuf
               INTO :oszSgUf:iSgUf
                  , :oszNmUf:iNmUf
               FROM apoio.uf
              WHERE iduf = :oszIdUf;


    if(iSgUf != -1) {
        STRCPY_FROM_ORA(ptUF->szSgUF, oszSgUf);
    }
    if(iNmUf != -1) {
        STRCPY_FROM_ORA(ptUF->szNmUF, oszNmUf);
    }


    ULOGI("Finalizando proCBuscaUF <FOUND>");
    ULOG_END("CUFpc::proCBuscaUF");
    return true;

    naoexiste:
        ULOGI("Finalizando proCBuscaUF <NOT FOUND>");
        return false;

    erro:
        ULOGE("Finalizando proCBuscaUF <ERROR>");
        throw new TuxBasicOraException(sqlca.sqlcode, sqlca.sqlerrm.sqlerrmc,sqlca.sqlerrm.sqlerrml);
}
