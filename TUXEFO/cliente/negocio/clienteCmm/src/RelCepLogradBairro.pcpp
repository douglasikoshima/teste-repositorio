#undef SQLCA
#define SQLCA_NONE
#include <sqlca.h>
#include <sqlda.h>

#include <tuxfw.h>
#include "../include/Exception.h"

#undef MSG_NONE
#define MSG_NONE
#include "../include/Messages.h"
#include "../include/Tools.h"


EXEC SQL BEGIN DECLARE SECTION;
#include "../include/Global.h"
EXEC SQL END DECLARE SECTION;

EXEC SQL INCLUDE "../include/RelCepLogradBairro.h";

//Construtor e Destrutor
CRelCepLogradBairro::CRelCepLogradBairro()
{
    memset(&tTabela, 0x00, sizeof(tTabela));
}

CRelCepLogradBairro::~CRelCepLogradBairro()
{

}


//Metodos Setters
void CRelCepLogradBairro::setCdLogradouro( char* pDado )
{
    if ( pDado == NULL )
    {
        tTabela.i_scdLogradouro = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.scdLogradouro, pDado);
        tTabela.i_scdLogradouro = 0;
    }
}
void CRelCepLogradBairro::setInCNL( char* pDado )
{
    if ( pDado == NULL )
    {
        tTabela.i_sinCNL = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sinCNL, pDado);
        tTabela.i_sinCNL = 0;
    }
}
void CRelCepLogradBairro::setCdIBGE( char* pDado )
{
    if ( pDado == NULL )
    {
        tTabela.i_scdIBGE = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.scdIBGE, pDado);
        tTabela.i_scdIBGE = 0;
    }
}

void CRelCepLogradBairro::setIdRelCepLogradBairro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIdRelCepLogradBairro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIdRelCepLogradBairro, pDado);
        tTabela.iIdRelCepLogradBairro_ora = 0;
    }
}

void CRelCepLogradBairro::setIdLogradouro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIdLogradouro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIdLogradouro, pDado);
        tTabela.iIdLogradouro_ora = 0;
    }
}

void CRelCepLogradBairro::setIdCep(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIdCep_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIdCep, pDado);
        tTabela.iIdCep_ora = 0;
    }
}

void CRelCepLogradBairro::setIdBairro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIdBairro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIdBairro, pDado);
        tTabela.iIdBairro_ora = 0;
    }
}

void CRelCepLogradBairro::setDtAtualizacaoOut(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDtAtualizacaoOut_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDtAtualizacaoOut, pDado);
        tTabela.iDtAtualizacaoOut_ora = 0;
    }
}

void CRelCepLogradBairro::setInLadoNumeracao(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iInLadoNumeracao_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sInLadoNumeracao, pDado);
        tTabela.iInLadoNumeracao_ora = 0;
    }
}

void CRelCepLogradBairro::setNrFinal(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNrFinal_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNrFinal, pDado);
        tTabela.iNrFinal_ora = 0;
    }
}

void CRelCepLogradBairro::setNrInicial(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNrInicial_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNrInicial, pDado);
        tTabela.iNrInicial_ora = 0;
    }
}

void CRelCepLogradBairro::setCodTituloLograd(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodTituloLograd_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodTituloLograd, pDado);
        tTabela.iCodTituloLograd_ora = 0;
    }
}

void CRelCepLogradBairro::setCodUsuarioAtualizacao(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodUsuarioAtualizacao_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodUsuarioAtualizacao, pDado);
        tTabela.iCodUsuarioAtualizacao_ora = 0;
    }
}

void CRelCepLogradBairro::setDscTituloLograd(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDscTituloLograd_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDscTituloLograd, pDado);
        tTabela.iDscTituloLograd_ora = 0;
    }
}

void CRelCepLogradBairro::setDscAbrevTituloLograd(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDscAbrevTituloLograd_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDscAbrevTituloLograd, pDado);
        tTabela.iDscAbrevTituloLograd_ora = 0;
    }
}

void CRelCepLogradBairro::setDatAtualizacaoOut(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDatAtualizacaoOut_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDatAtualizacaoOut, pDado);
        tTabela.iDatAtualizacaoOut_ora = 0;
    }
}

void CRelCepLogradBairro::setCodLogradouro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodLogradouro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodLogradouro, pDado);
        tTabela.iCodLogradouro_ora = 0;
    }
}

void CRelCepLogradBairro::setCodTipoLograd(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodTipoLograd_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodTipoLograd, pDado);
        tTabela.iCodTipoLograd_ora = 0;
    }
}

void CRelCepLogradBairro::setCodLocalidade(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodLocalidade_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodLocalidade, pDado);
        tTabela.iCodLocalidade_ora = 0;
    }
}

void CRelCepLogradBairro::setNomLogradouro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNomLogradouro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNomLogradouro, pDado);
        tTabela.iNomLogradouro_ora = 0;
    }
}

void CRelCepLogradBairro::setIndNumeracaoEndereco(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIndNumeracaoEndereco_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIndNumeracaoEndereco, pDado);
        tTabela.iIndNumeracaoEndereco_ora = 0;
    }
}

void CRelCepLogradBairro::setFlgComplemento(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iFlgComplemento_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sFlgComplemento, pDado);
        tTabela.iFlgComplemento_ora = 0;
    }
}

void CRelCepLogradBairro::setDscTipoLograd(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDscTipoLograd_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDscTipoLograd, pDado);
        tTabela.iDscTipoLograd_ora = 0;
    }
}

void CRelCepLogradBairro::setDscAbrevTipoLograd(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDscAbrevTipoLograd_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDscAbrevTipoLograd, pDado);
        tTabela.iDscAbrevTipoLograd_ora = 0;
    }
}

void CRelCepLogradBairro::setCodAreaTarifaria(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodAreaTarifaria_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodAreaTarifaria, pDado);
        tTabela.iCodAreaTarifaria_ora = 0;
    }
}

void CRelCepLogradBairro::setNumCodNacLocalidade(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNumCodNacLocalidade_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNumCodNacLocalidade, pDado);
        tTabela.iNumCodNacLocalidade_ora = 0;
    }
}

void CRelCepLogradBairro::setDscAbrevLocalidade(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDscAbrevLocalidade_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDscAbrevLocalidade, pDado);
        tTabela.iDscAbrevLocalidade_ora = 0;
    }
}

void CRelCepLogradBairro::setDscLocalidade(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iDscLocalidade_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sDscLocalidade, pDado);
        tTabela.iDscLocalidade_ora = 0;
    }
}

void CRelCepLogradBairro::setSglCodNacLocalidade(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iSglCodNacLocalidade_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sSglCodNacLocalidade, pDado);
        tTabela.iSglCodNacLocalidade_ora = 0;
    }
}

void CRelCepLogradBairro::setCodLocalidadePrinc(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodLocalidadePrinc_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodLocalidadePrinc, pDado);
        tTabela.iCodLocalidadePrinc_ora = 0;
    }
}

void CRelCepLogradBairro::setCodUF(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodUF_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodUF, pDado);
        tTabela.iCodUF_ora = 0;
    }
}

void CRelCepLogradBairro::setHorFusoHorario(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iHorFusoHorario_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sHorFusoHorario, pDado);
        tTabela.iHorFusoHorario_ora = 0;
    }
}

void CRelCepLogradBairro::setIdAreaTarifaria(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIdAreaTarifaria_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIdAreaTarifaria, pDado);
        tTabela.iIdAreaTarifaria_ora = 0;
    }
}

void CRelCepLogradBairro::setIdPessoaUsuario(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iIdPessoaUsuario_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sIdPessoaUsuario, pDado);
        tTabela.iIdPessoaUsuario_ora = 0;
    }
}

void CRelCepLogradBairro::setCdAreaTarifariaMiniCom(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCdAreaTarifariaMiniCom_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCdAreaTarifariaMiniCom, pDado);
        tTabela.iCdAreaTarifariaMiniCom_ora = 0;
    }
}

void CRelCepLogradBairro::setSglUF(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iSglUF_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sSglUF, pDado);
        tTabela.iSglUF_ora = 0;
    }
}

void CRelCepLogradBairro::setNomUF(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNomUF_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNomUF, pDado);
        tTabela.iNomUF_ora = 0;
    }
}

void CRelCepLogradBairro::setCodPais(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodPais_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodPais, pDado);
        tTabela.iCodPais_ora = 0;
    }
}

void CRelCepLogradBairro::setSglIsoPais(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iSglIsoPais_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sSglIsoPais, pDado);
        tTabela.iSglIsoPais_ora = 0;
    }
}

void CRelCepLogradBairro::setSglIso2Pais(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iSglIso2Pais_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sSglIso2Pais, pDado);
        tTabela.iSglIso2Pais_ora = 0;
    }
}

void CRelCepLogradBairro::setNomPais(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNomPais_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNomPais, pDado);
        tTabela.iNomPais_ora = 0;
    }
}

void CRelCepLogradBairro::setNumPais(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNumPais_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNumPais, pDado);
        tTabela.iNumPais_ora = 0;
    }
}

void CRelCepLogradBairro::setNumIsoPais(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNumIsoPais_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNumIsoPais, pDado);
        tTabela.iNumIsoPais_ora = 0;
    }
}

void CRelCepLogradBairro::setCodCEP(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodCEP_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodCEP, pDado);
        tTabela.iCodCEP_ora = 0;
    }
}

void CRelCepLogradBairro::setNumCEP(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNumCEP_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNumCEP, pDado);
        tTabela.iNumCEP_ora = 0;
    }
}

void CRelCepLogradBairro::setCodBairro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iCodBairro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sCodBairro, pDado);
        tTabela.iCodBairro_ora = 0;
    }
}

void CRelCepLogradBairro::setNomAbrevBairro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNomAbrevBairro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNomAbrevBairro, pDado);
        tTabela.iNomAbrevBairro_ora = 0;
    }
}

void CRelCepLogradBairro::setNomBairro(char* pDado)
{
    if ( pDado == NULL )
    {
        tTabela.iNomBairro_ora = -1;
    }
    else
    {
        STRCPY_TO_ORA(tTabela.sNomBairro, pDado);
        tTabela.iNomBairro_ora = 0;
    }
}



//Metodos Getters
char* CRelCepLogradBairro::getIdRelCepLogradBairro(void)
{
        return ((char*)tTabela.sIdRelCepLogradBairro.arr);
}
char* CRelCepLogradBairro::getIdLogradouro(void)
{
        return ((char*)tTabela.sIdLogradouro.arr);
}
char* CRelCepLogradBairro::getIdCep(void)
{
        return ((char*)tTabela.sIdCep.arr);
}
char* CRelCepLogradBairro::getIdBairro(void)
{
        return ((char*)tTabela.sIdBairro.arr);
}
char* CRelCepLogradBairro::getDtAtualizacaoOut(void)
{
        return ((char*)tTabela.sDtAtualizacaoOut.arr);
}
char* CRelCepLogradBairro::getInLadoNumeracao(void)
{
        return ((char*)tTabela.sInLadoNumeracao.arr);
}
char* CRelCepLogradBairro::getNrFinal(void)
{
        return ((char*)tTabela.sNrFinal.arr);
}
char* CRelCepLogradBairro::getNrInicial(void)
{
        return ((char*)tTabela.sNrInicial.arr);
}
char* CRelCepLogradBairro::getCodTituloLograd(void)
{
        return ((char*)tTabela.sCodTituloLograd.arr);
}
char* CRelCepLogradBairro::getCodUsuarioAtualizacao(void)
{
        return ((char*)tTabela.sCodUsuarioAtualizacao.arr);
}
char* CRelCepLogradBairro::getDscTituloLograd(void)
{
        return ((char*)tTabela.sDscTituloLograd.arr);
}
char* CRelCepLogradBairro::getDscAbrevTituloLograd(void)
{
        return ((char*)tTabela.sDscAbrevTituloLograd.arr);
}
char* CRelCepLogradBairro::getDatAtualizacaoOut(void)
{
        return ((char*)tTabela.sDatAtualizacaoOut.arr);
}
char* CRelCepLogradBairro::getCodLogradouro(void)
{
        return ((char*)tTabela.sCodLogradouro.arr);
}
char* CRelCepLogradBairro::getCodTipoLograd(void)
{
        return ((char*)tTabela.sCodTipoLograd.arr);
}
char* CRelCepLogradBairro::getCodLocalidade(void)
{
        return ((char*)tTabela.sCodLocalidade.arr);
}
char* CRelCepLogradBairro::getNomLogradouro(void)
{
        return ((char*)tTabela.sNomLogradouro.arr);
}
char* CRelCepLogradBairro::getIndNumeracaoEndereco(void)
{
        return ((char*)tTabela.sIndNumeracaoEndereco.arr);
}
char* CRelCepLogradBairro::getFlgComplemento(void)
{
        return ((char*)tTabela.sFlgComplemento.arr);
}
char* CRelCepLogradBairro::getDscTipoLograd(void)
{
        return ((char*)tTabela.sDscTipoLograd.arr);
}
char* CRelCepLogradBairro::getDscAbrevTipoLograd(void)
{
        return ((char*)tTabela.sDscAbrevTipoLograd.arr);
}
char* CRelCepLogradBairro::getCodAreaTarifaria(void)
{
        return ((char*)tTabela.sCodAreaTarifaria.arr);
}
char* CRelCepLogradBairro::getNumCodNacLocalidade(void)
{
        return ((char*)tTabela.sNumCodNacLocalidade.arr);
}
char* CRelCepLogradBairro::getDscAbrevLocalidade(void)
{
        return ((char*)tTabela.sDscAbrevLocalidade.arr);
}
char* CRelCepLogradBairro::getDscLocalidade(void)
{
        return ((char*)tTabela.sDscLocalidade.arr);
}
char* CRelCepLogradBairro::getSglCodNacLocalidade(void)
{
        return ((char*)tTabela.sSglCodNacLocalidade.arr);
}
char* CRelCepLogradBairro::getCodLocalidadePrinc(void)
{
        return ((char*)tTabela.sCodLocalidadePrinc.arr);
}
char* CRelCepLogradBairro::getCodUF(void)
{
        return ((char*)tTabela.sCodUF.arr);
}
char* CRelCepLogradBairro::getHorFusoHorario(void)
{
        return ((char*)tTabela.sHorFusoHorario.arr);
}
char* CRelCepLogradBairro::getIdAreaTarifaria(void)
{
        return ((char*)tTabela.sIdAreaTarifaria.arr);
}
char* CRelCepLogradBairro::getIdPessoaUsuario(void)
{
        return ((char*)tTabela.sIdPessoaUsuario.arr);
}
char* CRelCepLogradBairro::getCdAreaTarifariaMiniCom(void)
{
        return ((char*)tTabela.sCdAreaTarifariaMiniCom.arr);
}
char* CRelCepLogradBairro::getSglUF(void)
{
        return ((char*)tTabela.sSglUF.arr);
}
char* CRelCepLogradBairro::getNomUF(void)
{
        return ((char*)tTabela.sNomUF.arr);
}
char* CRelCepLogradBairro::getCodPais(void)
{
        return ((char*)tTabela.sCodPais.arr);
}
char* CRelCepLogradBairro::getSglIsoPais(void)
{
        return ((char*)tTabela.sSglIsoPais.arr);
}
char* CRelCepLogradBairro::getSglIso2Pais(void)
{
        return ((char*)tTabela.sSglIso2Pais.arr);
}
char* CRelCepLogradBairro::getNomPais(void)
{
        return ((char*)tTabela.sNomPais.arr);
}
char* CRelCepLogradBairro::getNumPais(void)
{
        return ((char*)tTabela.sNumPais.arr);
}
char* CRelCepLogradBairro::getNumIsoPais(void)
{
        return ((char*)tTabela.sNumIsoPais.arr);
}
char* CRelCepLogradBairro::getCodCEP(void)
{
        return ((char*)tTabela.sCodCEP.arr);
}
char* CRelCepLogradBairro::getNumCEP(void)
{
        return ((char*)tTabela.sNumCEP.arr);
}
char* CRelCepLogradBairro::getCodBairro(void)
{
        return ((char*)tTabela.sCodBairro.arr);
}
char* CRelCepLogradBairro::getNomAbrevBairro(void)
{
        return ((char*)tTabela.sNomAbrevBairro.arr);
}
char* CRelCepLogradBairro::getNomBairro(void)
{
        return ((char*)tTabela.sNomBairro.arr);
}



char* CRelCepLogradBairro::getCdLogradouro( void )
{
	ULOG( "(char*)tTabela.scdLogradouro.arr [%s]",(char*)tTabela.scdLogradouro.arr );
   return ((char*)tTabela.scdLogradouro.arr);
}
char* CRelCepLogradBairro::getInCNL(void)
{
	ULOG( "(char*)tTabela.sinCNL.arr [%s]",(char*)tTabela.sinCNL.arr );
   return ((char*)tTabela.sinCNL.arr);
}
char* CRelCepLogradBairro::getCdIBGE(void)
{
	ULOG( "(char*)tTabela.scdIBGE.arr [%s]",(char*)tTabela.scdIBGE.arr );
	
   return ((char*)tTabela.scdIBGE.arr);
}




int CRelCepLogradBairro::RecuperarPorCep(char* pNumCep)
{
    ULOG_START("CRelCepLogradBairro::RecuperarPorCep()");
    struct sqlca sqlca;

	EXEC SQL BEGIN DECLARE SECTION;
        VARCHAR sNumCep[LEN_CEP + LEN_EOS];
	EXEC SQL END DECLARE SECTION;

    STRCPY_TO_ORA(sNumCep, pNumCep);

	// Marca ponto de controle de erro
	EXEC SQL WHENEVER SQLERROR GOTO sqlErrorLista;

	// Declara e abre o cursor
	EXEC SQL 
	SELECT
        LOGRADOURO.COD_LOGRADOURO,
        LOCALIDADE.NUM_COD_NAC_LOCALIDADE,
        LOCALIDADE.NUM_COD_IBGE,
        TITULO_LOGRADOURO.DSC_TITULO_LOGRAD,
        TIPO_LOGRADOURO.DSC_TIPO_LOGRAD,
        LOGRADOURO.NOM_LOGRADOURO,
        LOCALIDADE.DSC_LOCALIDADE,
        BAIRRO.COD_BAIRRO,
        BAIRRO.NOM_BAIRRO,
        UNIDADE_FEDERACAO.COD_UF,
        UNIDADE_FEDERACAO.NOM_UF,
        PAIS.COD_PAIS,
        PAIS.NOM_PAIS
	INTO
		:tTabela.scdLogradouro:tTabela.i_scdLogradouro,
		:tTabela.sinCNL:tTabela.i_sinCNL,
		:tTabela.scdIBGE:tTabela.i_scdIBGE,
		:tTabela.sDscTituloLograd:tTabela.iDscTituloLograd_ora,
		:tTabela.sDscTipoLograd:tTabela.iDscTipoLograd_ora,
		:tTabela.sNomLogradouro:tTabela.iNomLogradouro_ora,
		:tTabela.sDscLocalidade:tTabela.iDscLocalidade_ora,
		:tTabela.sCodBairro:tTabela.iCodBairro_ora,
		:tTabela.sNomBairro:tTabela.iNomBairro_ora,
		:tTabela.sCodUF:tTabela.iCodUF_ora,
		:tTabela.sNomUF:tTabela.iNomUF_ora,
		:tTabela.sCodPais:tTabela.iCodPais_ora,
		:tTabela.sNomPais:tTabela.iNomPais_ora
	FROM
	    ENDERECO.REL_CEP_LOGRAD_BAIRRO REL_CEP_LOGRAD_BAIRRO,
	    ENDERECO.BAIRRO BAIRRO,
	    ENDERECO.CEP CEP,
	    ENDERECO.LOGRADOURO LOGRADOURO,
	    ENDERECO.TIPO_LOGRADOURO TIPO_LOGRADOURO,
	    ENDERECO.LOCALIDADE LOCALIDADE,
	    ENDERECO.TITULO_LOGRADOURO TITULO_LOGRADOURO,
	    ENDERECO.UNIDADE_FEDERACAO UNIDADE_FEDERACAO,
	    ENDERECO.PAIS PAIS
	WHERE REL_CEP_LOGRAD_BAIRRO.COD_CEP = CEP.COD_CEP
	AND   REL_CEP_LOGRAD_BAIRRO.COD_BAIRRO = BAIRRO.COD_BAIRRO
	AND   REL_CEP_LOGRAD_BAIRRO.COD_LOGRADOURO = LOGRADOURO.COD_LOGRADOURO
	AND   LOGRADOURO.COD_TIPO_LOGRAD = TIPO_LOGRADOURO.COD_TIPO_LOGRAD
	AND   LOGRADOURO.COD_LOCALIDADE = LOCALIDADE.COD_LOCALIDADE
	AND   LOGRADOURO.COD_TITULO_LOGRAD = TITULO_LOGRADOURO.COD_TITULO_LOGRAD
	AND   LOCALIDADE.COD_UF = UNIDADE_FEDERACAO.COD_UF
	AND   UNIDADE_FEDERACAO.COD_PAIS = PAIS.COD_PAIS
	AND   CEP.NUM_CEP = :sNumCep;

    ULOG_END("CRelCepLogradBairro::RecuperarPorCep()");
	if (sqlca.sqlcode == NO_DATA_FOUND)
        return NOK;
    else
        return OK;

	// Tratamento de erro - Lança excessão com o código oracle do erro.
	sqlErrorLista:
	    ULOGE("ERRO ORACLE -> sqlcode=%d,sqlerrmc=%.70s",sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc);
	    ULOG_END("CRelCepLogradBairro::RecuperarPorCep()");
		throw new TuxBasicOraException(sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc,sqlca.sqlerrm.sqlerrml);
}


bool CRelCepLogradBairro::existeCEP(char* pNumCep)
{
    ULOG_START("CRelCepLogradBairro::existeCEP()");
    struct sqlca sqlca;

	EXEC SQL BEGIN DECLARE SECTION;
        int iQtd;
        char* sNumCep = pNumCep;
	EXEC SQL END DECLARE SECTION;

    if( sNumCep == NULL )
    	sNumCep = "";

    ULOGI( "Inicio de pesquisa com CEP[%s]", sNumCep);

	// Marca ponto de controle de erro
	EXEC SQL WHENEVER SQLERROR GOTO sqlErrorLista;

	// Declara e abre o cursor
	EXEC SQL 
	 SELECT 
	 	COUNT(1)
	 INTO
	 	:iQtd
	 FROM
	 	ENDERECO.CEP
	 WHERE 
	 	NUM_CEP = SUBSTR(TRIM(:sNumCep),1,10)
	 AND
	 	ROWNUM < 2;

    ULOGI( "Quantidade de ocorrencias(%d)", iQtd);
    ULOG_END("CRelCepLogradBairro::existeCEP()");
	if(iQtd > 0)
        return true;
    else
        return false;

	// Tratamento de erro - Lança excessão com o código oracle do erro.
	sqlErrorLista:
	    ULOGE("ERRO ORACLE -> sqlcode=%d,sqlerrmc=%.70s",sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc);
	    ULOG_END("CRelCepLogradBairro::existeCEP()");
		throw new TuxBasicOraException(sqlca.sqlcode, sqlca.sqlerrm.sqlerrmc, sqlca.sqlerrm.sqlerrml);
}

CRelCepLogradBairro* CRelCepLogradBairro::RecuperarTodosPorFiltro(int* iNroObjetos, 
                                                 char *pNrCEP,
                                                 char *pDsLogradouro,
                                                 char *pDsLocalidade,
                                                 char *pDsBairro,
                                                 char *pIdUF)
{
    ULOG_START("CRelCepLogradBairro::RecuperarTodosPorFiltro()");
    struct sqlca sqlca;

    ULOGI("CRelCepLogradBairro::RecuperarTodosPorFiltro(%s,%s,%s,%s,%s)", pNrCEP, pDsLogradouro, pDsLocalidade, pDsBairro, pIdUF );
    
	CRelCepLogradBairro* poObj = NULL;
	int iNroObjLocal = 1;

	EXEC SQL BEGIN DECLARE SECTION;
        int iQtd;
        int iWhere = 0;
        char sCEP[255];
        char sLogradouro[255];
        
        char sCdLogradouro[255];
        char sInCNL[10];
        char sCdIBGE[10];
        
        char sLocalidade[255];
        char sBairro[255];
        char sUF[255];
        char cPesquisa[2000];
        char szAux[2000];
        char cCampos[255];
        char cFromWhere[1000];
        TRELCEPLOGRADBAIRROB01 tDados;
	EXEC SQL END DECLARE SECTION;

    memset(sCEP,        0x00, sizeof(sCEP));
    memset(sLogradouro, 0x00, sizeof(sLogradouro));

    memset(sCdLogradouro, 0x00, sizeof(sCdLogradouro));
    memset(sInCNL, 0x00, sizeof(sInCNL));
    memset(sCdIBGE, 0x00, sizeof(sCdIBGE));


    memset(sLocalidade, 0x00, sizeof(sLocalidade));
    memset(sBairro,     0x00, sizeof(sBairro));
    memset(sUF,         0x00, sizeof(sUF));
    memset(cPesquisa,   0x00, sizeof(cPesquisa));
    memset(cCampos,     0x00, sizeof(cCampos));
    memset(cFromWhere,  0x00, sizeof(cFromWhere));
    
    strcpy( cFromWhere, " FROM ENDERECO.DE_ENDERECO_PARA_APOIOV01 " );

    if(pNrCEP)
    {
    	strcat( cFromWhere, " WHERE " );
    	iWhere = 1;
	    
	    strcat( cFromWhere, "CODCEP = '" );
	    strcat( cFromWhere, pNrCEP );
	    strcat( cFromWhere, "'" );
    }

    if(pDsLogradouro)
    {
        if( !iWhere )
        {
	    	strcat( cFromWhere, " WHERE " );
	    	iWhere = 1;
	    }
	    else
	    	strcat( cFromWhere, " AND " );

	    strcat( cFromWhere, "NOMLOGRADOURO LIKE UPPER('" );


        ULOGI("A.pDsLogradouro[%s](%d)", pDsLogradouro, strlen(pDsLogradouro));
        memset(szAux, 0x00, sizeof(szAux));
        DuplicaCaracter(pDsLogradouro, szAux, 0x27);
        ULOGI("B.szAux[%s](%d)", szAux, strlen(szAux));


	    strcat( cFromWhere, szAux );
	    strcat( cFromWhere, "%%')" );
	}
    if(pDsLocalidade)
    {
        if( !iWhere )
        {
	    	strcat( cFromWhere, " WHERE " );
	    	iWhere = 1;
	    }
	    else
	    	strcat( cFromWhere, " AND " );

	    strcat( cFromWhere, "DSCLOCALIDADE LIKE UPPER('" );


        ULOGI("A.pDsLocalidade[%s](%d)", pDsLocalidade, strlen(pDsLocalidade));
        memset(szAux, 0x00, sizeof(szAux));
        DuplicaCaracter(pDsLocalidade, szAux, 0x27);
        ULOGI("B.szAux[%s](%d)", szAux, strlen(szAux));


	    strcat( cFromWhere, szAux );
	    strcat( cFromWhere, "%%')" );
	}	    	

    if(pDsBairro)
    {
        if( !iWhere )
        {
	    	strcat( cFromWhere, " WHERE " );
	    	iWhere = 1;
	    }
	    else
	    	strcat( cFromWhere, " AND " );

	    strcat( cFromWhere, "NOMBAIRRO LIKE UPPER('" );


        ULOGI("A.pDsBairro[%s](%d)", pDsBairro, strlen(pDsBairro));
        memset(szAux, 0x00, sizeof(szAux));
        DuplicaCaracter(pDsBairro, szAux, 0x27);
        ULOGI("B.szAux[%s](%d)", szAux, strlen(szAux));


	    strcat( cFromWhere, szAux );
	    strcat( cFromWhere, "%%')" );
	}	    	

    if(pIdUF)
    {
        strcpy(sUF, pIdUF);
        if( !iWhere )
        {
	    	strcat( cFromWhere, " WHERE " );
	    	iWhere = 1;
	    }
	    else
	    	strcat( cFromWhere, " AND " );

	    strcat( cFromWhere, "CODUFENDERECO = '" );
	    strcat( cFromWhere, sUF );
	    strcat( cFromWhere, "'" );
	}
	
	//conta quantos endereços existem
	strcpy( cPesquisa, "SELECT COUNT(1)" );
	strcat( cPesquisa, cFromWhere );
	//Se passar de 50 exibe mensagem pedindo para otimizar a pesquisa, então coloquei o ROWNUM < 52 para 
	//melhorar o tempo quando a pesqusa é muito grande
    if( !iWhere )
    {
    	strcat( cPesquisa, " WHERE " );
    	iWhere = 1;
    }
    else
    	strcat( cPesquisa, " AND " );
   	strcat( cPesquisa, " ROWNUM < 52 " );

    ULOGI( "Pesquisa de endereco[%s]", cPesquisa );


	EXEC SQL PREPARE qPesquisa FROM :cPesquisa;
	EXEC SQL DECLARE CursorContaEndereço CURSOR FOR qPesquisa;
    ULOGI("Antes de abrir o cursor para contar");
	EXEC SQL OPEN CursorContaEndereço;
    ULOGI("Depois de abrir o cursor para contar");
	EXEC SQL FETCH CursorContaEndereço INTO :iQtd;
	EXEC SQL CLOSE CursorContaEndereço;

    if (iQtd > 50 ){
	    *iNroObjetos = 51;
        return NULL;
    }

    ULOGI("Quantidade de retorno [%d]", iQtd);

	// Marca ponto de controle de erro
	EXEC SQL WHENEVER SQLERROR GOTO sqlErrorLista;
	EXEC SQL WHENEVER NOT FOUND CONTINUE;
	EXEC SQL WHENEVER NOT FOUND DO break;

	//Recupera os enderecos do usuario
    memset(cPesquisa,   0x00, sizeof(cPesquisa));
	strcpy( cPesquisa,
        "SELECT CDLOGRADOURO,"
               "INCNL,"
               "CDIBGE,"
               "DSCTITULOLOGRAD,"
               "DSCTIPOLOGRAD,"
               "NOMLOGRADOURO,"
               "DSCLOCALIDADE,"
               "CODBAIRRO,"
               "NOMBAIRRO,"
               "CODUFAPOIO,"
               "NOMUFAPOIO,"
               "SGLUFAPOIO,"
               "CODPAISAPOIO,"
               "NOMPAISAPOIO,"
               "SGLPAISAPOIO,"
               "CODCEP,"
               "INDLADONUMERACAO"
    );
	strcat( cPesquisa, cFromWhere );

    ULOGI( "Pesquisa de endereço: [%s]", cPesquisa );

	EXEC SQL PREPARE qPesquisa FROM :cPesquisa;
	EXEC SQL DECLARE cCursor CURSOR FOR qPesquisa;
    ULOGI("Antes de abrir o cursor");
	EXEC SQL OPEN cCursor;
    ULOGI("Depois de abrir o cursor");
    /* Contornando o problema de muitos registros na pesquisa */
	for (;; iNroObjLocal++) 
    {
        memset(&tDados, 0x00, sizeof(tDados));
		EXEC SQL 
		FETCH 
			cCursor
		INTO 
			:tDados.scdLogradouro:tDados.i_scdLogradouro,
			:tDados.sinCNL:tDados.i_sinCNL,
			:tDados.scdIBGE:tDados.i_scdIBGE,
			:tDados.sDscTituloLograd:tDados.iDscTituloLograd_ora,
			:tDados.sDscTipoLograd:tDados.iDscTipoLograd_ora,
			:tDados.sNomLogradouro:tDados.iNomLogradouro_ora,
			:tDados.sDscLocalidade:tDados.iDscLocalidade_ora,
			:tDados.sCodBairro:tDados.iCodBairro_ora,
			:tDados.sNomBairro:tDados.iNomBairro_ora,
			:tDados.sCodUF:tDados.iCodUF_ora,
			:tDados.sNomUF:tDados.iNomUF_ora,
			:tDados.sSglUF:tDados.iSglUF_ora,
			:tDados.sCodPais:tDados.iCodPais_ora,
			:tDados.sNomPais:tDados.iNomPais_ora,
			:tDados.sSglIsoPais:tDados.iSglIsoPais_ora,
			:tDados.sNumCEP:tDados.iNumCEP_ora,
			:tDados.sIndNumeracaoEndereco:tDados.iIndNumeracaoEndereco_ora;

		// Aloca memória para o objeto atual.
		if ((poObj = (CRelCepLogradBairro*) realloc((void *)poObj, (sizeof(CRelCepLogradBairro) * iNroObjLocal))) != NULL)
        {
			poObj[iNroObjLocal-1].setCdLogradouro( (char*)tDados.scdLogradouro.arr );
			poObj[iNroObjLocal-1].setInCNL( (char*)tDados.sinCNL.arr );
			poObj[iNroObjLocal-1].setCdIBGE( (char*)tDados.scdIBGE.arr );
			poObj[iNroObjLocal-1].setDscTituloLograd((char*)tDados.sDscTituloLograd.arr);
			poObj[iNroObjLocal-1].setDscTipoLograd((char*)tDados.sDscTipoLograd.arr);
			poObj[iNroObjLocal-1].setNomLogradouro((char*)tDados.sNomLogradouro.arr);
			poObj[iNroObjLocal-1].setDscLocalidade((char*)tDados.sDscLocalidade.arr);
			poObj[iNroObjLocal-1].setCodBairro((char*)tDados.sCodBairro.arr);
			poObj[iNroObjLocal-1].setNomBairro((char*)tDados.sNomBairro.arr);
			poObj[iNroObjLocal-1].setCodUF((char*)tDados.sCodUF.arr);
			poObj[iNroObjLocal-1].setNomUF((char*)tDados.sNomUF.arr);
			poObj[iNroObjLocal-1].setSglUF((char*)tDados.sSglUF.arr);
			poObj[iNroObjLocal-1].setCodPais((char*)tDados.sCodPais.arr);
			poObj[iNroObjLocal-1].setNomPais((char*)tDados.sNomPais.arr);
			poObj[iNroObjLocal-1].setSglIsoPais((char*)tDados.sSglIsoPais.arr);
			poObj[iNroObjLocal-1].setNumCEP((char*)tDados.sNumCEP.arr);
			poObj[iNroObjLocal-1].setIndNumeracaoEndereco( (atoi((char*)tDados.sIndNumeracaoEndereco.arr) == 1 ? "Impar" : "Par") );
		} 
        else 
        {
			if (poObj) 
                free(poObj);

	        EXEC SQL CLOSE cCursor;
			ERROR(NRO_MEMORIA);
			throw TuxBasicSvcException(sNrMsg,MSG_MEMORIA);
		}
	}

	EXEC SQL CLOSE cCursor;

	*iNroObjetos = iNroObjLocal - 1;
    ULOG_END("CRelCepLogradBairro::RecuperarTodosPorFiltro()");
	return poObj;


	// Tratamento de erro - Lança excessão com o código oracle do erro.
	sqlErrorLista:
	    ULOGE("ERRO ORACLE -> sqlcode=%d,sqlerrmc=%.70s",sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc);
	    ULOG_END("CRelCepLogradBairro::RecuperarTodosPorFiltro()");
		throw new TuxBasicOraException(sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc,
					sqlca.sqlerrm.sqlerrml);
}


CRelCepLogradBairro* CRelCepLogradBairro::RecuperarTodasUF(int* iNroObjetos)
{
    ULOG_START("CRelCepLogradBairro::RecuperarTodasUF()");
    struct sqlca sqlca;

    CRelCepLogradBairro* poObj = NULL;
    int iNroObjLocal = 1;

    EXEC SQL BEGIN DECLARE SECTION;
        TRELCEPLOGRADBAIRROB01    tDados;
    EXEC SQL END DECLARE SECTION;

	// Marca ponto de controle de erro
	EXEC SQL WHENEVER SQLERROR GOTO sqlErrorTodosUF;
	EXEC SQL WHENEVER NOT FOUND DO break;


    // Declara e abre o cursor
	EXEC SQL
	DECLARE 
		cTodasUF CURSOR FOR
	SELECT 
		COD_UF,
		SGL_UF,
		NOM_UF
	FROM 
		ENDERECO.UNIDADE_FEDERACAO;

	EXEC SQL OPEN cTodasUF;

	for (;; iNroObjLocal++) 
    {
        memset(&tDados, 0x00, sizeof(tDados));
		EXEC SQL 
		FETCH 
			cTodasUF
		INTO
			:tDados.sCodUF:tDados.iCodUF_ora,
			:tDados.sSglUF:tDados.iSglUF_ora,
			:tDados.sNomUF:tDados.iNomUF_ora;

		// Aloca memória para o objeto atual.
		if ((poObj = (CRelCepLogradBairro*) realloc((void *)poObj, (sizeof(CRelCepLogradBairro) * iNroObjLocal))) != NULL)
        {
			poObj[iNroObjLocal-1].setCodUF((char*)tDados.sCodUF.arr);
			poObj[iNroObjLocal-1].setNomUF((char*)tDados.sNomUF.arr);
			poObj[iNroObjLocal-1].setSglUF((char*)tDados.sSglUF.arr);
		} 
        else 
        {
			if (poObj) 
                free(poObj);

	        EXEC SQL CLOSE cTodasUF;
			ERROR(NRO_MEMORIA);
			throw TuxBasicSvcException(sNrMsg,MSG_MEMORIA);
		}
	}

	EXEC SQL CLOSE cTodasUF;

	*iNroObjetos = iNroObjLocal - 1;
	ULOG_END("CRelCepLogradBairro::RecuperarTodasUF()");
	return poObj;

	// Tratamento de erro - Lança excessão com o código oracle do erro.
sqlErrorTodosUF:
    ULOGE("ERRO ORACLE -> sqlcode=%d,sqlerrmc=%.70s",sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc);
    ULOG_END("CRelCepLogradBairro::RecuperarTodasUF()");
    throw new TuxBasicOraException(sqlca.sqlcode,sqlca.sqlerrm.sqlerrmc, sqlca.sqlerrm.sqlerrml);
}
