//EXEC SQL INCLUDE SQLCA;


#include <tuxfw.h>
#include "../../negocio/clienteCmm/include/Exception.h"
#include "../../negocio/clienteCmm/include/Funcoes.h"
#include "../../negocio/clienteCmm/include/Messages.h"

EXEC SQL BEGIN DECLARE SECTION;
#include "Global.h"
EXEC SQL END DECLARE SECTION;

EXEC SQL INCLUDE "../../negocio/clienteCmm/include/classCstAtributo.h";

DECLARE_TUXEDO_SERVICE(LAtributo);

void implLAtributo::Execute(DOMNode *pDnode, XMLGen *pXmlG)
{
CCstAtributo *oObj;
int iNroReg = 0;
int iAux = 0;

    try{

        ULOG_START( "implLAtributo::Execute()" );

		oObj = CCstAtributo::RecuperarTodos(&iNroReg);

        if ( !oObj )
		{
			pXmlG->addItem("FAILED","FAILED");
		}
		else
		{
		    pXmlG->createTag("SubAssuntoVO");
		    pXmlG->addProp("xmlns","cliente.fo.vivo.com.br/vo");
	        for (; iAux < iNroReg; iAux++) 
            {
		        pXmlG->createTag("AtributoVO");
		            pXmlG->addItem("idAtributo"                , oObj[iAux].getIdAtributo());
		            pXmlG->addItem("idSubassunto"              , oObj[iAux].getIdSubAssunto());
		            pXmlG->addItem("dsAtributo"                , oObj[iAux].getDsAtributo());
		            pXmlG->addItem("sqApresentacao"   ,          oObj[iAux].getSqApresentacao());
		            pXmlG->addItem("idTipoApresentacaoPergunta", oObj[iAux].getIdTAPergunta());
		            pXmlG->addItem("inDisponibilidade"         , oObj[iAux].getInDisponibilidade());
		        pXmlG->closeTag();
	        }
            pXmlG->closeTag();

            free(oObj); //Liberando a memoria alocada dentro da classe.

            ULOG_END( "implLAtributo::Execute()" );

			setStatusCode("00I0000","Success Execution");
		}
    }
    catch(...){
        throw;
    }

    return;

}



