/*
 * Serviço de cadastro básico de motivo de devolução de correspondencia
 * Versão inicial, 19/05/2004
 */

//EXEC SQL INCLUDE SQLCA;

EXEC SQL INCLUDE "../../negocio/clienteCmm/include/MotivoDevolucao.h";

#include "../include/MotivoDevolucaoInclui.h"
#include "../../negocio/clienteCmm/include/Messages.h"
#include "../../negocio/clienteCmm/include/Global.h"
#include <tuxfw.h>

DECLARE_TUXEDO_SERVICE(MotDevInc);

void implMotDevInc::Execute(DOMNode* dnode, XMLGen* xml_g) {

    CMotivoDevolucao oMotDev;
    int iRet;

    ULOG_START( "implMotDevInc::Execute()" );
    try{
        // Monta o objeto de MotivoDevolucao
        char* p = walkTree(dnode, XML_IN_SG_TIPO, 0);

        oMotDev.setSgMotivoDevolucao( p );

        XMLString::release(&p); 

        p = walkTree(dnode, XML_IN_DS_TIPO, 0);

        oMotDev.setDsMotivoDevolucao( p );

        XMLString::release(&p); 

        // Inclui o objeto no banco de dados
        oMotDev.setUsuarioAlteracao(getUser());
        iRet = oMotDev.inclui();

        switch(iRet)
        {
            case DUPLICATE_KEY:
                xml_g->addItem("FAILED", "DUPLICATE KEY");
                break;
        }
    }
    catch(...){
        throw;
    }

    ULOG_END( "implMotDevInc::Execute()" );

    // Execução OK.
    INFORMATION(NRO_OK);
    setStatusCode(sNrMsg, MSG_OK);
}

