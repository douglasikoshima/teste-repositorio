#undef SQLCA
#define SQLCA_NONE
#include <sqlca.h>
#include <sqlda.h>

#include "../../negocio/clienteCmm/include/Exception.h"
#include "../../negocio/clienteCmm/include/Messages.h"
#include <tuxfw.h>
#include "../../negocio/clienteCmm/include/Funcoes.h"
#include "../../negocio/clienteCmm/include/ApoioStatusUsuario.h"

#include "../include/GETSTATUSUSU.h"

EXEC SQL BEGIN DECLARE SECTION;
#include "Global.h"
EXEC SQL END DECLARE SECTION;

DECLARE_TUXEDO_SERVICE(GETSTATUSUSU);

void implGETSTATUSUSU::Execute(DOMNode *pDnode, XMLGen *pXmlG)
{
    int iCount;
    TApoioStatusUsuario *ptApoioStatusUsuario=NULL;
    ApoioStatusUsuario *pclApoioStatusUsuario=NULL;

    ULOG_START("implGETSTATUSUSU::Execute");

    try
    {
        pclApoioStatusUsuario = new ApoioStatusUsuario;


        pXmlG->createTag("ListaIdDescricaoVO");
        pXmlG->addProp("xmlns","admsistemas.fo.vivo.com.br/vo");

        for(iCount=0, ptApoioStatusUsuario=NULL; (ptApoioStatusUsuario=pclApoioStatusUsuario->buscaApoioStatusUsuario()) != NULL; iCount++)
        {
            pXmlG->createTag("itemListaIdDescricaoVO");
                pXmlG->addItem("id", ptApoioStatusUsuario->szIdStatusUsuario); ULOG("ptApoioStatusUsuario->szIdStatusUsuario[%s]", ptApoioStatusUsuario->szIdStatusUsuario);
                pXmlG->addItem("descricao", ptApoioStatusUsuario->szDsStatusUsuario); ULOG("ptApoioStatusUsuario->szDsStatusUsuario[%s]", ptApoioStatusUsuario->szDsStatusUsuario);
            pXmlG->closeTag();
        }

        pXmlG->closeTag();

    }
    catch(...)
    {
        ULOG("Exception!");

        if(pclApoioStatusUsuario) delete pclApoioStatusUsuario;

        ULOG_END("implGETSTATUSUSU::Execute");
        throw;
    }

    ULOG("local D");
    if(pclApoioStatusUsuario) delete pclApoioStatusUsuario;

    ULOG_END("implGETSTATUSUSU::Execute");

	INFORMATION(NRO_OK);
	setStatusCode(sNrMsg, MSG_OK);
}
