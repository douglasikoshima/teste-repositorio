#undef SQLCA
#define SQLCA_NONE
#include <sqlca.h>
#include <sqlda.h>

#include "../../negocio/clienteCmm/include/Exception.h"
#include "../../negocio/clienteCmm/include/Messages.h"
#include <tuxfw.h>
#include "../../negocio/clienteCmm/include/Funcoes.h"
#include "../../negocio/clienteCmm/include/LinhaConvergente.h"

EXEC SQL BEGIN DECLARE SECTION;
#include "Global.h"
EXEC SQL END DECLARE SECTION;

DECLARE_TUXEDO_SERVICE(GETLINHACONV);

void implGETLINHACONV::Execute(DOMNode *dnode, XMLGen *xml_g)
{
    char *pAux=0;
    char szNrTelefone[25+1];
    memset(&szNrTelefone, 0, sizeof(szNrTelefone));

    CLinhaConvergente* pclLinhaConvergente=0;
    unsigned int iCont=0;

    ULOG_START( "implGETLINHACONV::Execute()" );

    try
    {
    	if((pAux = walkTree(dnode, "nrTelefone", 0))) {
    		strcpy(szNrTelefone, pAux);
    		XMLString::release(&pAux);
    	}
    	ULOG("szNrTelefone[%s]", szNrTelefone);

    	pclLinhaConvergente = new CLinhaConvergente;

    	pclLinhaConvergente->buscaLinhasPorNumero(szNrTelefone, xml_g);

    	delete pclLinhaConvergente;
    }
    catch(...)
    {
        ULOG("Exception!");
        if (pclLinhaConvergente)
        	delete pclLinhaConvergente;
        throw;
    }

    ULOG_END( "implGETLINHACONV::Execute()" );

	INFORMATION(NRO_OK);
	setStatusCode(sNrMsg, MSG_OK);
}
