/* $Id: GeraSenhaPC.pcpp,v 1.1 2009/07/31 15:34:02 a5110702 Exp $ */

#undef SQLCA
#define SQLCA_NONE
#include<sqlca.h>
#include<sqlda.h>

#include <tuxfw.h>

void sql_error_gerasenha(sqlca*sqlca);
bool proCBuscaCPFUsuario(int idPessoa, char *cpf)
{
    ULOG_START("proCBuscaCPFUsuario()");
    struct sqlca sqlca;

    EXEC SQL BEGIN DECLARE SECTION;

        int idpessoa = idPessoa;
        char cpfpessoa[5];

    EXEC SQL END DECLARE SECTION;

    EXEC SQL WHENEVER SQLERROR  DO sql_error_gerasenha(&sqlca);
    EXEC SQL WHENEVER NOT FOUND GOTO cpfNotFound;

    EXEC SQL 
        SELECT
            cpf
        INTO
            :cpfpessoa
        FROM
            customer.CpfPessoaV07
        WHERE
            idPessoaOrigem = :idpessoa; 

    strcpy(cpf, cpfpessoa);
    
    ULOG_END("proCBuscaCPFUsuario()");

    return true;

    cpfNotFound:
        return false;
}

void sql_error_gerasenha(sqlca*sqlca)
{
    throw TuxBasicOraException(sqlca->sqlcode);
}
