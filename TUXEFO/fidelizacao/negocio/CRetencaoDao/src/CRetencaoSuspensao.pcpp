#include <CRetencaoSuspensao.h>


int CRetencaoSuspensao::Inserir(DOMNode *pdnode,char *pidUser,char *pidRetencao)
{

	char parm[255];
	int iPog=0;
	EXEC SQL BEGIN DECLARE SECTION;
		VARCHAR     idRetencao[21+1];
		VARCHAR	 dtInicio[21+1];
		VARCHAR	 dtFim[21+1];
		VARCHAR	 idUser[21+1];
	EXEC SQL END DECLARE SECTION;
	EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

  
   strToOra(idRetencao,pidRetencao);

   iPog=get_tag(parm,pdnode,"dtInicio",0,-1); 
   
   if( iPog == -1 ) 
   	 return 1;
   	
   strToOra(dtInicio,parm);

   get_tag(parm,pdnode,"dtFim",0,0); 
   strToOra(dtFim,parm);

   strToOra(idUser,pidUser);
   endOraStr(idUser);

   ULOG_VAR(idUser);

  EXEC SQL
        INSERT INTO retencao.RETENCAOSUSPENSAO
        ( 
			IDRETENCAO, 
			DTINICIO,
			DTFIM,
			IDUSUARIOINCLUSAO,
			DTINCLUSAO
        )
        VALUES 
        ( 
            :idRetencao,
            to_date(:dtInicio,'DD/MM/YYYY'),
            to_date(:dtFim,'DD/MM/YYYY'),
            :idUser,
            SYSDATE
        );

	
	return 1;
	
}

