
#include <CRetencaoPlano.h>


int CRetencaoPlano::Inserir(DOMNode *pdnode,char *pidUser,char *pidRetencao)
{
    ULOG_START( "CRetencaoPlano::Inserir()" );

    char parm[255];
    parm[0] = 0x0;
    
    EXEC SQL BEGIN DECLARE SECTION;
    
        VARCHAR     idRetencao[21+1];
        VARCHAR     planoAtual[256];
        VARCHAR     novoPlano[256];
        VARCHAR     idNovoPlano[21+1];
        VARCHAR     idUser[21+1];
        
    EXEC SQL END DECLARE SECTION;

    EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

    strToOra(idRetencao,pidRetencao);

    get_tag(parm,pdnode,"planoAtual",0,0); 
    strToOra(planoAtual,parm);

    parm[0] = 0x0;
    get_tag(parm,pdnode,"novoPlano",0,0); 
    strToOra(novoPlano,parm);

    parm[0] = 0x0;
    get_tag(parm,pdnode,"idNovoPlano",0,0); 
    strToOra(idNovoPlano,parm);

    strToOra(idUser,pidUser);

    ULOG_VAR(idUser);

    ULOG( "INSERT RETENCAO.RETENCAOPLANOS idRetencao [%s] - novoPlano [%s] - planoAtual [%s] - idNovoPlano [%s] ", 
          (char*)idRetencao.arr,
          (char*)novoPlano.arr,
          (char*)planoAtual.arr,
          (char*)idNovoPlano.arr
          );
    
    EXEC SQL
    INSERT INTO RETENCAO.RETENCAOPLANOS
    ( 
        IDRETENCAO,
        NMNOVOPLANO,
        NMPLANOATUAL,
        IDUSUARIOINCLUSAO,
        DTINCLUSAO,
        IDPLANO
    )
    VALUES 
    ( 
        :idRetencao,
        :novoPlano,
        :planoAtual,
        :idUser,
        SYSDATE,
        :idNovoPlano
    );

    ULOG_END( "CRetencaoPlano::Inserir()" );

    return 1;
}
