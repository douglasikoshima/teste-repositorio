
#include "../../negocio/fidutil/include/retencao.hpp"

int LstGruposDesconto( XMLGen * xml )
{
    
    EXEC SQL BEGIN DECLARE SECTION;
        VARCHAR idGrupo[40];
        VARCHAR nmGrupo[256];
    EXEC SQL END DECLARE SECTION;

    memset( &idGrupo , 0x0, sizeof(idGrupo) );
    memset( &nmGrupo , 0x0, sizeof(nmGrupo) );
    
    EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  
    try
    {
        EXEC SQL WHENEVER NOT FOUND DO BREAK;
        EXEC SQL DECLARE crsGrupo CURSOR FOR
        SELECT
           GRUPO.IDGRUPO ,
           GRUPO.NMGRUPO
        FROM
           ACESSO.GRUPO GRUPO
        WHERE
           GRUPO.IDGRUPO IN
        (
           SELECT
              GRUPOMOTIVOORDEM.IDGRUPO
           FROM
              RETENCAO.GRUPOMOTIVOORDEM GRUPOMOTIVOORDEM
        )
        ORDER BY
           TRIM(UPPER(GRUPO.NMGRUPO));
   
        EXEC SQL OPEN crsGrupo;
        for(;;)
        {
            EXEC SQL 
            FETCH crsGrupo INTO :idGrupo ,
                                :nmGrupo ;

            endOraStr( idGrupo );
            endOraStr( nmGrupo );

            xml->createTag("listaGrupoRetencao");
                xml->addItem("id",(char*)idGrupo.arr);
                xml->addItem("ds",(char*)nmGrupo.arr);
            xml->closeTag();
        }
        EXEC SQL CLOSE crsGrupo;
    }
    catch(...)
    {
        throw;
    }
    
  return 1;
}
