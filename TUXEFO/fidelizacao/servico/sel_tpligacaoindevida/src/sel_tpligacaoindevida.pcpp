#include "../../negocio/fidutil/include/retencao.hpp"


int sel_tpligacaoindevida(int usuario, DOMNode*dnode, XMLGen*xml)
{

  EXEC SQL BEGIN DECLARE SECTION;
  int     idTipoEncerramento;
  VARCHAR dsTipoEncerramento[255];
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  EXEC SQL WHENEVER NOT FOUND DO break;

  try{
    // Definicao dos cursores
    EXEC SQL DECLARE crsTpEnc CURSOR FOR

      SELECT IDTIPOENCERRAMENTO,DSTIPOENCERRAMENTO
      FROM   RETENCAO.TIPOENCERRAMENTO
	  WHERE  INLIGACAOINDEVIDA = 1
	  ORDER BY DSTIPOENCERRAMENTO;

    EXEC SQL OPEN crsTpEnc;
    
    for(;;) 
	{

      EXEC SQL FETCH crsTpEnc into :idTipoEncerramento,
								   :dsTipoEncerramento;

      endOraStr(dsTipoEncerramento);
      ULOG_INT(idTipoEncerramento);
      ULOG_VAR(dsTipoEncerramento);

      xml->createTag("tns:itemListaVO");
		xml->addItem("id",idTipoEncerramento);
		xml->addItem("descricao",(char *)dsTipoEncerramento.arr);
      xml->closeTag();
    }

    EXEC SQL CLOSE crsTpEnc;
  }
  catch(...)
  {
	   throw;
  }

  return 1;
}


