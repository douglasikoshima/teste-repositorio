//
// $Id: ins_script.pcpp,v 1.1.118.1 2012/07/13 18:09:25 a5114878 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"

int ins_script(int usuario, DOMNode*dnode, XMLGen*xml)
{
  char parm[50];
  int  i=0;

  EXEC SQL BEGIN DECLARE SECTION;
  varchar     nrTelefone[10+1];
  int		  idUsuario=usuario;
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

  try
  {
    //  Obtendo dados do xml
    get_tag(parm,dnode,"nrTelefone",0,0);
	strToOra(nrTelefone,parm);

	EXEC SQL
		UPDATE RETENCAO.CLIENTEBLINDAGEM
			SET DTBLOQUEIOEXIBICAO=SYSDATE,
				IDUSUARIOBLOQUEIO=:idUsuario
		WHERE cdarearegistro=SUBSTR(:nrTelefone,1,2)
		AND	 nrlinha =SUBSTR(:nrTelefone,3);
 

    // Insert OK*/
    xml->addItem("descricao","OK");
    xml->addItem("valor",i);
  }
  catch(...)
  {	
	  //throw;
	  ULOG("OPS");
	  xml->addItem("descricao","OK");
	  xml->addItem("valor",i);
  }

  return 1;
}


