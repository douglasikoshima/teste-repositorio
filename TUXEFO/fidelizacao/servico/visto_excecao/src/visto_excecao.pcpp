//
// $Id: visto_excecao.pcpp,v 1.1 2009/07/31 15:33:36 a5110702 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"

int visto_excecao(int usuario, DOMNode*dnode, XMLGen*xml)
{
  char parm[50];
  int  i;
 
  EXEC SQL BEGIN DECLARE SECTION;
  int     idCaracteristicaOfertaAceita;
  int     idPessoaUsuarioAlteracao;
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

  try{
    // Pegando id do usuario
    idPessoaUsuarioAlteracao  = usuario;
  
    i = 0;
    while ( get_tag(parm,dnode,"id",i,-1) != -1 ) 
	{
      idCaracteristicaOfertaAceita = atoi(parm);
    
      EXEC SQL 
	update retencao.caracteristicaOfertaAceita
	set    vlPropriedade = '2',
	idPessoaUsuarioAlteracao = :idPessoaUsuarioAlteracao,
	dtAlteracao = sysdate,
	idUsuarioAlteracao = :idPessoaUsuarioAlteracao,
	dtUltimaAlteracao = sysdate
	where  idCaracteristicaOfertaAceita = :idCaracteristicaOfertaAceita;
    i++;
    }

    // insert OK 
    xml->addItem("descricao","MODIFICADO");
    xml->addItem("valor",i);
  }catch(...){throw;}

  return 1;
}

