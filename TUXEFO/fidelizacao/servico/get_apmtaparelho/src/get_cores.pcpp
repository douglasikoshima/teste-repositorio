//
// $Id: get_cores.pcpp,v 1.1 2009/07/31 15:34:46 a5110702 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"

int get_cores(DOMNode*dnode,XMLGen*xml)
{
    
  EXEC SQL BEGIN DECLARE SECTION;
    int idCor;
    VARCHAR nmCor[255];
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  EXEC SQL WHENEVER NOT FOUND DO break;

  try{
    EXEC SQL DECLARE crsCor CURSOR FOR
      SELECT idCor,nmCor
      FROM apoio.cor
	    ORDER BY nmCor; 

    EXEC SQL OPEN crsCor;

    for(;;) {
      EXEC SQL FETCH crsCor INTO :idCor,:nmCor;
      endOraStr(nmCor);
      ULOG_INT(idCor);
      ULOG_VAR(nmCor);
      xml->createTag("tns:itemListaVO");
      xml->addItem("id",idCor);
      xml->addItem("descricao",(char *)nmCor.arr);
      xml->closeTag();
    }
  
    EXEC SQL CLOSE crsCor;
  }catch(...){throw;}
  
  return 1;
}
