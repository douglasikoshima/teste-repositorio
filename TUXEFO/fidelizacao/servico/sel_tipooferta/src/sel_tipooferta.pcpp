//
// $Id: sel_tipooferta.pcpp,v 1.1 2009/07/31 15:35:07 a5110702 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"

int sel_tipooferta(int usuario, DOMNode*dnode, XMLGen*xml)
{
  EXEC SQL BEGIN DECLARE SECTION;
  int		  idUnidadeOferta;
  VARCHAR     nmOferta[255];
  
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  EXEC SQL WHENEVER NOT FOUND DO break;

  try
  {
    		 EXEC SQL DECLARE crsOfrtBonus CURSOR FOR
				SELECT IDUNIDADEOFERTA,NMOFERTA
				FROM  RETENCAO.OFERTA
			    WHERE IDUNIDADEOFERTA IN (SELECT IDUNIDADEOFERTA FROM RETENCAO.OFERTATIPOBONUS)
			    ORDER BY NMOFERTA;

    EXEC SQL OPEN crsOfrtBonus;

    for(;;) 
	{
      EXEC SQL FETCH crsOfrtBonus INTO :idUnidadeOferta,:nmOferta ;

	  endOraStr(nmOferta);
      ULOG_INT(idUnidadeOferta);

      xml->createTag("tns:itemListaDescricaoVO");
		xml->addItem("id",idUnidadeOferta);
		xml->addItem("descricao1",(char *)nmOferta.arr);
      xml->closeTag();
    }
  
    EXEC SQL CLOSE crsOfrtBonus;
  }
  catch(...)
  {
	throw;
  }

    return 1;

}

