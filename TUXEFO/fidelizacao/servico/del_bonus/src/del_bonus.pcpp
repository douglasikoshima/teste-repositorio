//
// $Id: del_bonus.pcpp,v 1.1 2009/07/31 15:34:44 a5110702 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"

int delete_bonus(int usuario, DOMNode*dnode,XMLGen*xml)
{
  char parm[50];

  EXEC SQL BEGIN DECLARE SECTION;
    int	    idMatrizBonus;
    int     idPessoaUsuarioAlteracao;
    EXEC SQL END DECLARE SECTION;
    EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

    try{
      //  Obtendo dados do xml
      get_tag(parm, dnode, "idMatrizBonus", 0, 0);
      idMatrizBonus = atoi(parm);
	
      // Pegando id do usuario
      idPessoaUsuarioAlteracao = usuario;
	
      /* Update linha */
      EXEC SQL UPDATE retencao.matrizbonus
	SET inativo = 0       ,
	idPessoaUsuarioAlteracao = :idPessoaUsuarioAlteracao,
	dtAlteracao = sysdate,
	idUsuarioAlteracao = :idPessoaUsuarioAlteracao,
	dtUltimaAlteracao = sysdate
	WHERE idmatrizbonus = :idMatrizBonus;
  
      // Operacao OK
      xml->addItem("descricao","EXCLUIR");
      xml->addItem("valor",sqlca.sqlerrd[2]);

    }catch(...){throw;}
    
    return 1;
}
