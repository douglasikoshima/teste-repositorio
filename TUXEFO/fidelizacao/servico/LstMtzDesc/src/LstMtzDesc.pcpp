
#include "../../negocio/fidutil/include/retencao.hpp"

int LstMtzDesc( int usuario, DOMNode * dnode, XMLGen * xml )
{

    EXEC SQL BEGIN DECLARE SECTION;
        VARCHAR idDesconto[40]; 
        VARCHAR dsDesconto[101]; 
    EXEC SQL END DECLARE SECTION;
    EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
    EXEC SQL WHENEVER NOT FOUND DO BREAK;

    try
    {
        EXEC SQL DECLARE crsMtzDesconto CURSOR FOR
        SELECT   iddesconto, dsdescontopercentual
            FROM retencao.desconto
           WHERE inativo = 1
        ORDER BY (UPPER (dsdescontopercentual));
        
        EXEC SQL OPEN crsMtzDesconto;
        for(;;)
        {
            EXEC SQL 
            FETCH crsMtzDesconto INTO   :idDesconto, 
                                        :dsDesconto;

            endOraStr( idDesconto );
            endOraStr( dsDesconto );

            xml->createTag("listaMatriz");
                xml->addItem("idMatriz",(char*)idDesconto.arr);
                xml->addItem("dsMatriz",(char*)dsDesconto.arr);
            xml->closeTag();
        }
        EXEC SQL CLOSE crsMtzDesconto;
    }
    catch(...)
    {
        throw;
    }
    
  return 1;
}
