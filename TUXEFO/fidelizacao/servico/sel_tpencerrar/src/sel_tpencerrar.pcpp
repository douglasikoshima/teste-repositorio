//
// $Id: sel_tpencerrar.pcpp,v 1.1 2009/07/31 15:33:57 a5110702 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"


int sel_tpencerrar(int usuario, DOMNode*dnode, XMLGen*xml)
{

  EXEC SQL BEGIN DECLARE SECTION;
  int     idTipoEncerramento;
  VARCHAR dsTipoEncerramento[255];
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  EXEC SQL WHENEVER NOT FOUND DO break;

  try{
    // Definicao dos cursores
    EXEC SQL DECLARE crsTpEnc CURSOR FOR
      select idTipoEncerramento,dsTipoEncerramento
      from   retencao.tipoEncerramento
	  order by dsTipoEncerramento;

    EXEC SQL OPEN crsTpEnc;
    
    for(;;) {

      EXEC SQL FETCH crsTpEnc into :idTipoEncerramento,:dsTipoEncerramento;

      endOraStr(dsTipoEncerramento);
      ULOG_INT(idTipoEncerramento);
      ULOG_VAR(dsTipoEncerramento);
      xml->createTag("tns:itemListaVO");
      xml->addItem("id",idTipoEncerramento);
      xml->addItem("descricao",(char *)dsTipoEncerramento.arr);
      xml->closeTag();
    }

    EXEC SQL CLOSE crsTpEnc;
  }catch(...){throw;}

  return 1;
}


