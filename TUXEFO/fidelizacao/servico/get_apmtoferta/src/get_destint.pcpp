//
// $Id: get_destint.pcpp,v 1.1 2009/07/31 15:33:42 a5110702 Exp $
//

#include "../../negocio/fidutil/include/retencao.hpp"

int get_destint(int perg, char *nmPar, XMLGen*xml)
{

  EXEC SQL BEGIN DECLARE SECTION;
    int     idResposta;
    int     idPergunta;
    VARCHAR dsResposta[2000];
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  EXEC SQL WHENEVER NOT FOUND DO break;
  
  try
  {
    idPergunta = perg;

    EXEC SQL DECLARE crsDfdstAll CURSOR FOR
      SELECT IDRESPOSTA, DSRESPOSTA
      FROM questionario.resposta
      WHERE inDisponibilidade != 0
      and   idPergunta = :idPergunta
	   ORDER BY DSRESPOSTA;
  
    EXEC SQL OPEN crsDfdstAll;
  
    for(;;) 
	{
      EXEC SQL FETCH crsDfdstAll INTO :idResposta,:dsResposta;
      endOraStr(dsResposta);
      xml->createTag("tns:itemListaVO");
      xml->addItem("id",idResposta);
      xml->addItem("descricao",(char *)dsResposta.arr);
      xml->closeTag();
    }
  
    EXEC SQL CLOSE crsDfdstAll;
  }catch(...){throw;}

  return 1;
}

