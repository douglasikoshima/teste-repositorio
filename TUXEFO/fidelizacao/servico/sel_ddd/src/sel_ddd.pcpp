

#include "../../negocio/fidutil/include/retencao.hpp"


int sel_ddd( XMLGen *xml )
{
    ULOG_START( "sel_ddd()" );

    EXEC SQL BEGIN DECLARE SECTION;

        int     idAreaRegistro = -1;
        int     ddd = -1;
        
    EXEC SQL END DECLARE SECTION;

    EXEC SQL WHENEVER SQLERROR DO sql_error( NULL );
    EXEC SQL WHENEVER NOT FOUND DO break;

    try
    {

        // Definicao dos cursores
        EXEC SQL DECLARE crsAreaRegistro CURSOR FOR
        SELECT 
           IDAREAREGISTRO,
           CDAREAREGISTRO
        FROM
           APOIO.AREAREGISTRO
        WHERE
           INBLOQUEADO = 0
        AND
           IDAREAREGISTRO > 0
        ORDER BY CDAREAREGISTRO;
            
        EXEC SQL OPEN crsAreaRegistro;
        for(;;) 
        {
	        EXEC SQL FETCH crsAreaRegistro INTO :idAreaRegistro,:ddd;

	        ULOG_INT( idAreaRegistro );
	        ULOG_INT( ddd );
            
	        xml->createTag( "listaDDD" );
	            xml->addItem( "id", idAreaRegistro );
	            xml->addItem( "nrDDD", ddd );
	        xml->closeTag();
        }

        EXEC SQL CLOSE crsAreaRegistro;

    }
    catch(...)
    {
        throw;
    }

    ULOG_END( "sel_ddd()" );

  return 1;
}

