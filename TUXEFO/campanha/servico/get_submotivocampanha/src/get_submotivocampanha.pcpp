//
// $Id: get_submotivocampanha.pcpp,v 1.1 2009/07/31 15:33:31 a5110702 Exp $
//

#include "../../negocio/cmputil/include/campanha.hpp"

int get_listatiposubmotivocampanha(char * usuario, DOMNode*dnode,XMLGen*xml)
{
  
  EXEC SQL BEGIN DECLARE SECTION;
    int idtiposubmotivoCampanha;
    VARCHAR sgtiposubmotivoCampanha[255];
    VARCHAR dstiposubmotivoCampanha[255];
    int inAtivo;
    int     idPessoaUsuarioAlteracao;
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
  EXEC SQL WHENEVER NOT FOUND DO break;

  inAtivo = 1;

  // Pegando id do usuario
  idPessoaUsuarioAlteracao = get_idUsuario(usuario);

  EXEC SQL DECLARE crstiposubmotivoCampanha CURSOR FOR
    SELECT idtiposubmotivoCampanha,sgtiposubmotivoCampanha,dstiposubmotivoCampanha
    FROM apoio.tiposubmotivocampanha
    WHERE indisponibilidade = 1
    AND inativo = :inAtivo;
  
  EXEC SQL OPEN crstiposubmotivoCampanha;

  xml->addItem("nome","TIPOSUBMOTIVOCAMPANHA");
  for(;;)
  {
    EXEC SQL FETCH crstiposubmotivoCampanha INTO :idtiposubmotivoCampanha,:sgtiposubmotivoCampanha,:dstiposubmotivoCampanha;
    endOraStr(sgtiposubmotivoCampanha);
    endOraStr(dstiposubmotivoCampanha);
    xml->createTag("tns:ApoioVO");
    xml->addItem("codigo",idtiposubmotivoCampanha);
    xml->addItem("sigla",(char *)sgtiposubmotivoCampanha.arr);
    xml->addItem("descricao",(char *)dstiposubmotivoCampanha.arr);
    xml->addItem("peso","null");
    xml->addItem("variante","null");
    xml->closeTag();
  }
  
  EXEC SQL CLOSE crstiposubmotivoCampanha;
  
  return 1;
}
