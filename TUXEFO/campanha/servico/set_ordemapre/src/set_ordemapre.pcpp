//
// $Id: set_ordemapre.pcpp,v 1.1 2009/07/31 15:33:20 a5110702 Exp $
//

#include "../../negocio/cmputil/include/campanha.hpp"

int set_ordemapre(int usuario, DOMNode*dnode, XMLGen*xml)
{
  char parm[256];
  int  i;

  EXEC SQL BEGIN DECLARE SECTION;
  int     idPergunta;
  int     sqApresentacao;
  int     idPessoaUsuarioAlteracao;
  EXEC SQL END DECLARE SECTION;
  EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

  try{
    // Pegando id do usuario
    idPessoaUsuarioAlteracao = usuario;

    i = 0;
    while( get_tag(parm,dnode,"idPergunta",i,-1) != -1 ){
      idPergunta = atoi(parm);

      get_tag(parm,dnode,"sqApresentacao",i,0);
      sqApresentacao = atoi(parm);

      // Update 
      EXEC SQL 
	update  questionario.Pergunta
	set     sqApresentacao = :sqApresentacao,
	idUsuarioAlteracao = :idPessoaUsuarioAlteracao,
	dtUltimaAlteracao = sysdate
	where   idPergunta = :idPergunta;

      i++;
    }

    // Update OK
    xml->addItem("descricao","MODIFICADO");
    xml->addItem("valor",i);
  }catch(...){throw;}

  return 1;
}

