//
// $Id: set_ordemcamp.pcpp,v 1.1 2009/07/31 15:33:51 a5110702 Exp $
//

#include "../../negocio/cmputil/include/campanha.hpp"

int set_ordemcamp(int usuario, DOMNode*dnode, XMLGen*xml)
{
	char parm[256];
	int  i;

	EXEC SQL BEGIN DECLARE SECTION;
	int     idSubCampanhaHistorico;
	int     sqApresentacao;
	int     idPessoaUsuarioAlteracao;
	EXEC SQL END DECLARE SECTION;
	EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

	try
	{
		// Pegando id do usuario
		idPessoaUsuarioAlteracao = usuario;

		i = 0;
		while( get_tag(parm,dnode,"idSubCampanhaHistorico",i,-1) != -1 )
		{
			idSubCampanhaHistorico = atoi(parm);

			get_tag(parm,dnode,"sqApresentacao",i,0);
			sqApresentacao = atoi(parm);

			// Update 
			EXEC SQL 
				update  
					campanha.subcampanhahistorico
				set 
					sqApresentacao = :sqApresentacao,
					idUsuarioAlteracao = :idPessoaUsuarioAlteracao,
					dtUltimaAlteracao = sysdate
				where   
					IDSUBCAMPANHAHISTORICO = :idSubCampanhaHistorico;
			i++;
		}

		// Update OK
		xml->addItem("descricao","MODIFICADO");
		xml->addItem("valor",i);
	}
	catch(...){throw;}

  return 1;
}
