//
// $Id: get_arearegistro.pcpp,v 1.1 2009/07/31 15:34:22 a5110702 Exp $
//

#include "../../negocio/cmputil/include/campanha.hpp"

int get_arearegistro(int usuario, DOMNode*dnode, XMLGen*xml)
{
	char parm[255];

	EXEC SQL BEGIN DECLARE SECTION;
		VARCHAR	idUFOperadora[21+1]; 
		VARCHAR	idAreaRegistro[21+1]; 
		VARCHAR	dsAreaRegistro[21+1]; 
	EXEC SQL END DECLARE SECTION;

	EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
	EXEC SQL WHENEVER NOT FOUND DO break;

	try{
		//  Obtendo dados do xml
		get_tag(parm, dnode, "idUFOperadora", 0, 0);
		strToOra(idUFOperadora, parm);

		// Definicao dos cursores  
		EXEC SQL DECLARE crsAreaRegistro CURSOR FOR
		SELECT 	 
			IDAREAREGISTRO, 
			CDAREAREGISTRO 
		FROM
			APOIO.AREAREGISTRO
		WHERE
			IDUFOPERADORA = :idUFOperadora
		ORDER BY
			CDAREAREGISTRO;

		EXEC SQL OPEN crsAreaRegistro;


		/* xml->createTag("AreasRegistroVO");
		 xml->createProp("xmlns", "campanha.fo.vivo.com.br/vo");*/
			
		for(;;)
		{
			EXEC SQL FETCH crsAreaRegistro INTO :idAreaRegistro, 
												:dsAreaRegistro;

			endOraStr(idAreaRegistro);
			endOraStr(dsAreaRegistro);

			xml->createTag("AreaRegistro");
			xml->addItem("idAreaRegistro", (char*)idAreaRegistro.arr);
			xml->addItem("dsAreaRegistro", (char*)dsAreaRegistro.arr);
			xml->closeTag();
		}


		EXEC SQL CLOSE crsAreaRegistro;
	}catch(...){throw;}

	return 1;
}
