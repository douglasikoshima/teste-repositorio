//
// $Id: del_canal.pcpp,v 1.1 2009/07/31 15:34:02 a5110702 Exp $
//

#include "../../negocio/cmputil/include/campanha.hpp"

int del_canal(char * usuario, DOMNode*dnode,XMLGen*xml)
{
	char parm[256];

	EXEC SQL BEGIN DECLARE SECTION;
		int		idCanal;
		int		inAtivo;
		int     idPessoaUsuarioAlteracao;
	EXEC SQL END DECLARE SECTION;
	EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

    //  Obtendo dados do xml

	get_tag(parm, dnode, "idCanal", 0, 0);
		idCanal = atoi(parm);
	
	// Pegando id do usuario
	idPessoaUsuarioAlteracao = get_idUsuario(usuario);
	
	inAtivo = 0;

	/* Update linha */
	EXEC SQL UPDATE apoio.canal
	    SET inativo = :inAtivo,
			idPessoaUsuarioAlteracao = :idPessoaUsuarioAlteracao,

			dtAlteracao = sysdate
		WHERE idcanal = :idCanal;
  
	if (sqlca.sqlcode)
	{
		throw new TuxBasicSvcException("00E1000","UPDATE apoio.canal ");
	}
  
	/* update OK */
	xml->createTag("CAMPANHA");
		xml->addItem("UPDATE",sqlca.sqlerrd[2]);
	xml->closeTag();
  
	return 1;
}
