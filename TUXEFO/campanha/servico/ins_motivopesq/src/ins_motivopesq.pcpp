//
// $Id:  .cpp,v 1.1 2004/05/17 17:55:07 wfonseca Exp 
//

#include "../../negocio/cmputil/include/campanha.hpp"

int ins_motivopesq(char * usuario, DOMNode*dnode,XMLGen*xml)
{
	char parm[256];

	EXEC SQL BEGIN DECLARE SECTION;
		VARCHAR sgMotivo[255];
		VARCHAR nmMotivo[255];
		int     idPessoaUsuarioAlteracao;
		int	inAtivo;
                int     idMotivo = 0;
	EXEC SQL END DECLARE SECTION;
	EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);

    //  Obtendo dados do xml

	get_tag(parm, dnode, "sgMotivo", 0, 0);
	strToOra(sgMotivo,parm);

    //  Obtendo dados do xml

	get_tag(parm, dnode, "nmMotivo", 0, 0);
	strToOra(nmMotivo,parm);

	// Pegando id do usuario
	idPessoaUsuarioAlteracao = get_idUsuario(usuario);

	inAtivo = 1;

	/* Verifica se existe o item a adcionar */
	EXEC SQL DECLARE crsMotivo CURSOR FOR
                SELECT MOTIVO.idtipomotivocampanha
                FROM   apoio.tipomotivocampanha MOTIVO
                WHERE  MOTIVO.inativo = 1
                AND    (trim(UPPER(MOTIVO.sgtipomotivocampanha)) = UPPER(trim(:sgMotivo))
                OR     UPPER(trim(MOTIVO.dstipomotivocampanha)) = UPPER(trim(:nmMotivo)));
	EXEC SQL OPEN crsMotivo;

	for(;;) 
	{
		EXEC SQL FETCH crsMotivo INTO :idMotivo;
		break;
	}
  
	EXEC SQL CLOSE crsMotivo;	
	
	// xml->createTag("MOTIVOPESQ");
	xml->addItem("descricao","idTipoMotivoCampanha");
	xml->addItem("valor",idMotivo);
	// xml->closeTag();

	return 1;

}
