//
// $Id: get_campanha.pcpp,v 1.1 2009/07/31 15:33:27 a5110702 Exp $
//

#include "../../negocio/cmputil/include/campanha.hpp"

int get_listacampanha(char * usuario, DOMNode*dnode,XMLGen*xml)
{
  
	EXEC SQL BEGIN DECLARE SECTION;
		struct
		{
			VARCHAR idCampanha[21+1];
			VARCHAR sgCampanha[255+1];
			VARCHAR dsCampanha[2000+1];
		}stGeral;
	EXEC SQL END DECLARE SECTION;

	EXEC SQL WHENEVER SQLERROR DO sql_error(NULL);
	EXEC SQL WHENEVER NOT FOUND DO break;

	EXEC SQL 
	DECLARE 
		crsCampanha CURSOR FOR
	SELECT
		CAMPANHA.IDCAMPANHA,
		CAMPANHA.SGCAMPANHA,
		CAMPANHA.DSCAMPANHA
	FROM
		APOIO.CAMPANHA CAMPANHA
	WHERE
		CAMPANHA.INATIVO = 1 
	ORDER BY 
		UPPER(TRIM(CAMPANHA.SGCAMPANHA));
  
	EXEC SQL OPEN crsCampanha;
	
	xml->addItem("nome","CAMPANHA");
	for(;;) 
	{
		memset( &stGeral, 0, sizeof( stGeral ) );
		EXEC SQL 
		FETCH crsCampanha 
		INTO 
			:stGeral.idCampanha,
			:stGeral.sgCampanha,
			:stGeral.dsCampanha;

		xml->createTag("tns:ApoioVO");
		xml->addItem("codigo",(char *)stGeral.idCampanha.arr);
		xml->addItem("sigla",(char *)stGeral.sgCampanha.arr);
		xml->addItem("descricao",(char *)stGeral.dsCampanha.arr);
		xml->addItem("peso","");
		xml->addItem("variante", "");
		xml->closeTag();
	}
	
	EXEC SQL CLOSE crsCampanha;
	
	return 1;
}
