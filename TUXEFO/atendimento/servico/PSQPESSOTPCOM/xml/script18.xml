string query;
string txt;
string idPessoa;
string idTipoComunic;
XMLGen saida;
RECORDSET rs;
int rsError;

idPessoa = XML:idPessoa;
idTipoComunic = XML:idTipoComunicacao;

// Obtem a descricao do tipo de comunicacao.
SQL SELECT dsTipoComunicacao tpComunic FROM apoio.TipoComunicacaob00 where idTipoComunicacao = :idTipoComunic;

txt = "<AtendimentoVO xmlns=\"workflow.fo.vivo.com.br/vo\">\n" +
	"<PessoaVO xmlns=\"workflow.fo.vivo.com.br/vo\">\n\t" +
		"<AtendimentoTipoComunicacaoVO xmlns=\"workflow.fo.vivo.com.br/vo\">\n\t\t" +
			"<idTipoComunicacao>" + idTipoComunic + "</idTipoComunicacao>\n\t\t" +
			"<descricao>" + tpComunic + "</descricao>\n\t\t";

// Obtem os tipos de comunicacao.
Clean(query);
query = "SELECT idPessoaComunicacao, dsContato FROM customer.PessoaComunicacaoB00 WHERE idPessoa = :idPessoa AND idTipoComunicacao = :idTipoComunic";
rs=OpenRecordset(query);

rsError = rs.GetError();
                        
if (rsError)
	println("Erro ao executar a query dos contatos...");
	return "Erro na execução do script (busca contatos).";
fi;

while(!rs.EOF())

	txt += "<AtendimentoComunicacaoVO>\n\t\t\t" +
		"<idComunicacao>" + rs.GetValue("idPessoaComunicacao") + "</idComunicacao>\n\t\t\t" +
		"<descricao>" + rs.GetValue("dsContato") + "</descricao>\n\t\t" +
	"</AtendimentoComunicacaoVO>\n\t\t";

		rs.MoveNext();

loop;

txt += "</AtendimentoTipoComunicacaoVO>\n\t</PessoaVO>\n</AtendimentoVO>";

saida = txt;

return saida;
