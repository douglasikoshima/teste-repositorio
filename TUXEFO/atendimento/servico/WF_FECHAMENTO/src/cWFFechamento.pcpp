#undef SQLCA
#define SQLCA_NONE
#include <sqlca.h>
#include <sqlda.h>
#include <ctype.h>

#include "../include/cWFFechamento.h"


void sql_error_WFFechamento( sqlca * sqlca );

void cWFFechamento::GetTime( char *sData, int iFormato )
{
   struct sqlca sqlca;

   EXEC SQL BEGIN DECLARE SECTION;
      char sDataSQL[25];
   EXEC SQL END DECLARE SECTION;

   sDataSQL[0] = 0x0;

   EXEC SQL WHENEVER SQLERROR DO sql_error_WFFechamento( &sqlca );
   if ( iFormato == 0 )
   {
        EXEC SQL 
            SELECT 
                TO_CHAR( SYSDATE,'DD/MM/YYYY HH24:MI' )
            INTO
                :sDataSQL
            FROM DUAL;
        sprintf( sData,"%.16s",sDataSQL );
   }
   else
   {
        EXEC SQL 
            SELECT 
                TO_CHAR( SYSDATE,'DD/MM/YYYY HH24:MI:SS' )
            INTO
                :sDataSQL
            FROM DUAL;
        sprintf( sData,"%.19s",sDataSQL );
   }


}



void sql_error_WFFechamento( sqlca * sqlca )
{
    ULOGE( "sql_error_WFFechamento:sqlcode = [%d],sqlerrmc = [%.70s]"
                              ,sqlca->sqlcode
                              ,sqlca->sqlerrm.sqlerrmc);

    throw new TuxBasicOraException(  sqlca->sqlcode
                                    ,sqlca->sqlerrm.sqlerrmc
                                    ,sqlca->sqlerrm.sqlerrml
                                  );

}

