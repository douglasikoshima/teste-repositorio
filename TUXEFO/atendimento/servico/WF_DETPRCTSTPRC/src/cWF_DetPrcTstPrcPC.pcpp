

#include "../include/cWF_DetPrcTstPrcPC.h"

EXEC SQL WHENEVER SQLERROR DO sql_error_DetalheProcesso(&sqlca);


int cWF_DetPrcTstPrcPC::SaveTesteResposta(char crs,int idt,int iat,int iusr)
{
    ULOG_START("cWF_DetPrcTstPrcPC::SaveTesteResposta()");
    struct sqlca sqlca;


	EXEC SQL BEGIN DECLARE SECTION;
		VARCHAR vcrs[2];
		int piusr;
		int pidt;
		int piat;
		int idTesteResposta;
	EXEC SQL END DECLARE SECTION;

	piusr=iusr;
	pidt=idt;
	piat=iat;
	vcrs.arr[0]=crs;
	vcrs.len=1;
	EXEC SQL SELECT atendimento.TesteRespostaSQ.nextval INTO :idTesteResposta FROM DUAL;
	EXEC SQL INSERT INTO 
         atendimento.TesteResposta(
	                                 IDTesteResposta
                                    ,DSResposta
                                    ,IDTeste
                                    ,IDAtendimentoTeste
                                    ,IDUsuarioAlteracao
                                    ,DTUltimaAlteracao)
		                     VALUES(:idTesteResposta
                                   ,:vcrs
                                   ,:pidt
                                   ,:piat
                                   ,:piusr
                                   ,SYSDATE);

    ULOG("Informacoes Salvas");
    
    ULOG_END("cWF_DetPrcTstPrcPC::SaveTesteResposta()");
	return idTesteResposta;

}



int cWF_DetPrcTstPrcPC::SaveAtendimentoTeste(int iat,int iusr,char*pobs)
{
    ULOG_END("cWF_DetPrcTstPrcPC::SaveAtendimentoTeste()");
    struct sqlca sqlca;

	EXEC SQL BEGIN DECLARE SECTION;
		VARCHAR pvobs[256];
		int piusr;
		int piat;
		int idATeste;
	EXEC SQL END DECLARE SECTION;

	piusr=iusr;
	piat=iat;
	TO_VARCHAR(pvobs,pobs);
	EXEC SQL SELECT atendimento.AtendimentoTesteSQ.nextval INTO :idATeste FROM DUAL;
	EXEC SQL INSERT INTO 
            atendimento.AtendimentoTeste(idAtendimentoTeste
                                           ,dtTeste
                                           ,idAtendimento
                                           ,idPessoaUsuario
                                           ,idUsuarioAlteracao
                                           ,dtUltimaAlteracao
                                           ,dsobservacao)
		                            VALUES(:idATeste
                                          , sysdate
                                          ,:piat
                                          ,:piusr
                                          ,:piusr
                                          , sysdate
                                          ,:pvobs);

    ULOG_END("cWF_DetPrcTstPrcPC::SaveAtendimentoTeste()");

	return idATeste;

}



void cWF_DetPrcTstPrcPC::sql_error_DetalheProcesso( sqlca * sqlca )
{
    ULOGE( "sql_error_WFFechamento:sqlcode = [%d],sqlerrmc = [%.70s]"
                              ,sqlca->sqlcode
                              ,sqlca->sqlerrm.sqlerrmc);


	throw new TuxBasicOraException(sqlca->sqlcode,sqlca->sqlerrm.sqlerrmc,sqlca->sqlerrm.sqlerrml);
}
