
#include "../include/cWF_CanAcaoPC.h"


// SQL SELECT TO_CHAR(SYSDATE, 'DD/MM/YYYY HH24:MI') DATAATUAL FROM DUAL;

bool cWF_Cancelamento::getSysDate()
{
	struct sqlca sqlca;

	EXEC SQL BEGIN DECLARE SECTION;
	  char     dsSysdate[256];
	EXEC SQL END DECLARE SECTION;

	EXEC SQL WHENEVER SQLERROR DO sql_error_WF_Encaminham(&sqlca);

	EXEC SQL 
		SELECT TO_CHAR(SYSDATE, 'DD/MM/YYYY HH24:MI') into :dsSysdate FROM DUAL;
	
	sSysDate = TString(dsSysdate).Trim();


	return true;

}

void cWF_Cancelamento::sql_error_WF_Encaminham(sqlca*sqlca)
{
	throw new TuxBasicOraException(sqlca->sqlcode,sqlca->sqlerrm.sqlerrmc,sqlca->sqlerrm.sqlerrml);
}


/*

bool cWF_Cancelamento::existeProcessoCri(int idUsuarioAtualProcesso)
{
	if (m_vlDados.idAtendimento == -1)
		return false;
    if ( ExisteProcessoCri(&m_stDados, &m_vlDados ) == true )
    {
       // verirfica se o usaruio que esta tentando cancelar o processo e o mesmo usuario cri 
       if ( proCObtemWFUsuarioAtualCriCMS(m_stDados.idAtendimento) == idUsuarioAtualProcesso )
       {   // se igual retorna false o sistema continua noseu processo correto 
           return false; 
       } 
       else
       {   // se diferente  retorna true  o sistema cria uma msg de continua noseu processo correto 
           return true; 
       }
    } 
    else
    {
 	   return false;
    }
}


bool cWF_Cancelamento::ExisteProcessoCri(long idAtendimento )
{
    tuxfw_getlogger()->debug(mensagemSimples("> proCObtemWFExisteProcessoCri"));

	struct sqlca sqlca;
   	
	EXEC SQL BEGIN DECLARE SECTION; 
		long aux_idAtendimento = idAtendimento;
		int  idExisteAtendiemnto = 0 ;
		short i_idExisteAtendiemnto = -1;

    EXEC SQL END DECLARE SECTION;

	memcpy(&oDados,  dados,  sizeof(oDados));
	memcpy(&oStatus, status, sizeof(oStatus));

    EXEC SQL WHENEVER SQLERROR  DO sql_error_WFAtdTratamentoCri(&sqlca);
	EXEC SQL WHENEVER NOT FOUND CONTINUE;

	EXEC SQL 
	SELECT 
		COUNT(1)
	INTO
		:idExisteAtendiemnto:i_idExisteAtendiemnto
	FROM 
		Atendimento.GrupoCri
	WHERE 
		idAtendimento = :oDados.idAtendimento;

	bool ret = false ;
	if (idExisteAtendiemnto > 0)
	{
        ret = true ;
	}
    tuxfw_getlogger()->debug(mensagemSimples("< proCObtemWFExisteProcessoCri"));

	return ret;
}
*/
