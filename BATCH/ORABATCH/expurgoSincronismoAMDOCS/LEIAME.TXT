======================================
BATCH......: expurgoSincronismoAMDOCS
Criado por.: Lucas Gomes Fenelon de Moraes (12/04/2016)
Funcional..: Erika Brum
======================================

====================================== 
OBJETIVO
====================================== 
	O propósito deste documento é coletar, analisar e definir os requisitos de Software
	Funcionais, não Funcionais e detalhar a Solução técnica da Base CRM, impactada na 
	demanda 945014 - Sincronismo Beatrix.
====================================== 

====================================== 
ESCOPO
====================================== 
	Este documento descreve os requisitos funcionais e não funcionais de software e 
	solução necessários para expurgo dos registros sem logica nas tabelas 
	des amarrações BSUNICA do projeto marcas - Base unica, solicitada pela Vivo. 
====================================== 

====================================== 
SOBRE ESTE BATCH
====================================== 
	O sistema faz, de forma macro, 3 delete's (os números correspondem ao tópico 6.4.2.2 do documento funcional);
	
	6.4.2.2	RS04.2.2 – Criar Batch para Expurgo das Tabelas
		Descrição

		Criar um script para expurgar os registros mais antigos que 3 meses (valor parametrizado) das entidades CONVERGENTE_OW.FILASINCRONISMOAMDOCS, CONVERGENTE_OW.LOG_SINCRONISMO_XML e CONVERGENTE_OW.LOG_SINCRONISMO.

		Nome: expurgoSincronismoAMDOCS
		Tecnologia: batch/shell
		Servidor Produção: ARAME
		Servidor Homologação: CAMPANIA
		Diretório: BATCH\ORABATCH/expurgoSincronismoAMDOCS 
		Diretório de logs: BATCH\ORABATCH\expurgoSincronismoAMDOCS\log
		Diretório de Arquivo: BATCH\ORABATCH\expurgoSincronismoAMDOCS\hist
		Nome dos Arquivos de Backup: ‘expurgoFILASINCRONISMOAMDOCS_<data atual>’, ‘expurgoLOG_SINCRONISMO_<data atual>’ e ‘expurgoLOG_SINCRONISMOXML_<data atual>’
		Tipo dos Arquivos de Backup: Texto compactado
		Periodicidade de execução: Mensalmente, no primeiro dia do mês, durante a madrugada
		  
		Comportamento Inicial

		1.	O Script recupera o valor do atributo DSVALORPARAMETRO cujo CDPARAMETRO seja igual à QTD_MES_EXPURGO_FILA_SINCRONISMO_AMDOCS.
		2.	O Script recupera os valores do atributo IDFILAAMDOCS na entidade CONVERGENTE_OW.FILASINCRONISMOAMDOCS em que o atributo DTULTIMAALTERACAO seja mais antigo que a data atual menos a quantidade de meses recuperado no passo 1.
		3.	O Script utiliza os valores de IDFILAMDOCS recuperados no passo 2 para recuperar os valores do atributo IDLOGSINCRONISMO dos registros relacionados na entidade CONVERGENTE_OW.LOG_SINCRONISMO.
		4.	O Script utiliza os valores de IDLOGSINCRONISMO recuperados no passo 3 para recuperar os valores do atributo IDLOGSINCRONISMOXML dos registros relacionados na entidade CONVERGENTE_OW.LOG_SINCRONISMOXML.
		5.	O Script insere todos os dados dos registros recuperados no passo 2 em arquivo texto compactado, com o nome ‘expurgoFILASINCRONISMOAMDOCS_<data atual>’ e o armazena no diretório BATCH\ORABATCH\expurgoSincronismoAMDOCS\hist. 
		6.	O Script insere todos os dados dos registros recuperados no passo 3 em arquivo texto compactado, com o nome ‘expurgoLOG_SINCRONISMO_<data atual>’ e o armazena no diretório BATCH\ORABATCH\expurgoSincronismoAMDOCS\hist. 
		7.	O Script insere todos os dados dos registros recuperados no passo 4 em arquivo texto compactado, com o nome ‘expurgoLOG_SINCRONISMOXML_<data atual>’ e o armazena no diretório BATCH\ORABATCH\expurgoSincronismoAMDOCS\hist. 
		8.	O Script exclui os registros recuperados no passo 4 da entidade CONVERGENTE_OW.LOG_SINCRONISMOXML.
		9.	O Script exclui os registros recuperados no passo 3 da entidade CONVERGENTE_OW.LOG_SINCRONISMO.
		10.	O Script exclui os registros recuperados no passo 2 da entidade CONVERGENTE_OW.FILASINCRONISMOAMDOCS.
		11.	O caso de uso é finalizado.

		Comportamento Final
		Expurgo realizado com sucesso.

	O sistema faz, de forma macro uma exclusão (os números correspondem ao tópico 6.4.2.3 do documento funcional);
	
	6.4.2.3	RS04.2.3 – Criar Batch para Expurgo dos Arquivos
		Descrição

		Criar um script para expurgar os arquivos de backup da Fila de Sincronismo e LOGs do Sincronismo da AMDOCS após 24 meses de criação dos arquivos.

		Nome: expurgoArquivosSincronismoAMDOCS
		Tecnologia: batch/shell
		Servidor Produção: ARAME
		Servidor Homologação: CAMPANIA
		Diretório: BATCH\ORABATCH/expurgoSincronismoAMDOCS 
		Diretório de logs: BATCH\ORABATCH\expurgoSincronismoAMDOCS\log
		Diretório dos Arquivos: BATCH\ORABATCH\expurgoSincronismoAMDOCS\hist
		Nome dos Arquivos de Backup: ‘expurgoFILASINCRONISMOAMDOCS_<data atual>’, ‘expurgoLOG_SINCRONISMO_<data atual>’ e ‘expurgoLOG_SINCRONISMOXML_<data atual>’
		Periodicidade de execução: Mensalmente, no primeiro dia do mês, durante a madrugada
		  
		Comportamento Inicial

		1.	O Script recupera o valor do atributo DSVALORPARAMETRO cujo CDPARAMETRO seja igual à QTD_MES_EXPURGO_ARQUIVOS_AMDOCS.
		2.	O Script recupera do diretório abaixo os arquivos cujo a Data de Criação seja mais antigo que a data atual menos a quantidade de meses recuperado no passo 1.

		Diretório: BATCH\ORABATCH\expurgoSincronismoAMDOCS\hist

		3.	O Script exclui os arquivos recuperados no passo anterior.
		4.	O caso de uso é finalizado.

		Comportamento Final
		Expurgo dos arquivos realizado realizado com sucesso.

	Criar um novo processo batch para expurgar fisicamente log e fila de sincronismo. O mesmo deve ser executado todos os dias apagando os registros de acordo com parâmetros da tabela de parâmetros:
	- com CDPARAMETRO = 'QTD_MES_EXPURGO_FILA_SINCRONISMO_AMDOCS'
	- com CDPARAMETRO = 'QTD_MES_EXPURGO_ARQUIVOS_AMDOCS'

====================================== 

======================================
SCRIPT DE CRIAÇÃO DOS PARAMETROS 
====================================== 

